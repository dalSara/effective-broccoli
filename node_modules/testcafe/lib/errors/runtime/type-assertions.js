'use strict';

exports.__esModule = true;
exports.is = undefined;

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _isNan = require('babel-runtime/core-js/number/is-nan');

var _isNan2 = _interopRequireDefault(_isNan);

exports.assertType = assertType;

var _lodash = require('lodash');

var _ = require('./');

var _message = require('./message');

var _message2 = _interopRequireDefault(_message);

var _hook = require('../../api/request-hooks/hook');

var _hook2 = _interopRequireDefault(_hook);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const START_FROM_VOWEL_RE = /^[aeiou]/i;

function getIndefiniteArticle(text) {
    return START_FROM_VOWEL_RE.test(text) ? 'an' : 'a';
}

function isNonNegativeValue(value) {
    return (0, _lodash.isFinite)(value) && value >= 0;
}

function getNumberTypeActualValueMsg(value, type) {
    if (type !== 'number') return type;

    if ((0, _isNan2.default)(value)) return NaN;

    if (!(0, _lodash.isFinite)(value)) return Infinity;

    return value;
}

var is = exports.is = {
    number: {
        name: 'number',
        predicate: _lodash.isFinite,
        getActualValueMsg: getNumberTypeActualValueMsg
    },

    nonNegativeNumber: {
        name: 'non-negative number',
        predicate: isNonNegativeValue,
        getActualValueMsg: getNumberTypeActualValueMsg
    },

    nonNegativeNumberString: {
        name: 'non-negative number',
        predicate: value => isNonNegativeValue(parseInt(value, 10)),

        getActualValueMsg: value => {
            var number = parseInt(value, 10);

            return isNaN(number) ? (0, _stringify2.default)(value) : number;
        }
    },

    boolean: {
        name: 'boolean',
        predicate: (value, type) => type === 'boolean'
    },

    string: {
        name: 'string',
        predicate: (value, type) => type === 'string'
    },

    function: {
        name: 'function',
        predicate: (value, type) => type === 'function'
    },

    regExp: {
        name: 'regular expression',
        predicate: _lodash.isRegExp
    },

    array: {
        name: 'array',
        predicate: value => Array.isArray(value)
    },

    nonNullObject: {
        name: 'non-null object',
        predicate: (value, type) => type === 'object' && !(0, _lodash.isNil)(value),
        getActualValueMsg: (value, type) => (0, _lodash.isNil)(value) ? String(value) : type
    },

    requestHookSubclass: {
        name: 'RequestHook subclass',
        predicate: value => value instanceof _hook2.default && value.constructor && value.constructor !== _hook2.default
    }
};

function assertType(types, callsiteName, what, value) {
    types = Array.isArray(types) ? types : [types];

    var pass = false;
    var actualType = typeof value;
    var actualMsg = actualType;
    var expectedTypeMsg = '';
    var last = types.length - 1;

    types.forEach((type, i) => {
        pass = pass || type.predicate(value, actualType);

        if (type.getActualValueMsg) actualMsg = type.getActualValueMsg(value, actualType);

        if (i === 0) expectedTypeMsg += type.name;else expectedTypeMsg += (i === last ? ' or ' + getIndefiniteArticle(type.name) + ' ' : ', ') + type.name;
    });

    if (!pass) {
        throw callsiteName ? new _.APIError(callsiteName, _message2.default.invalidValueType, what, expectedTypeMsg, actualMsg) : new _.GeneralError(_message2.default.invalidValueType, what, expectedTypeMsg, actualMsg);
    }
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9lcnJvcnMvcnVudGltZS90eXBlLWFzc2VydGlvbnMuanMiXSwibmFtZXMiOlsiYXNzZXJ0VHlwZSIsIlNUQVJUX0ZST01fVk9XRUxfUkUiLCJnZXRJbmRlZmluaXRlQXJ0aWNsZSIsInRleHQiLCJ0ZXN0IiwiaXNOb25OZWdhdGl2ZVZhbHVlIiwidmFsdWUiLCJnZXROdW1iZXJUeXBlQWN0dWFsVmFsdWVNc2ciLCJ0eXBlIiwiTmFOIiwiSW5maW5pdHkiLCJpcyIsIm51bWJlciIsIm5hbWUiLCJwcmVkaWNhdGUiLCJpc0Zpbml0ZU51bWJlciIsImdldEFjdHVhbFZhbHVlTXNnIiwibm9uTmVnYXRpdmVOdW1iZXIiLCJub25OZWdhdGl2ZU51bWJlclN0cmluZyIsInBhcnNlSW50IiwiaXNOYU4iLCJib29sZWFuIiwic3RyaW5nIiwiZnVuY3Rpb24iLCJyZWdFeHAiLCJpc1JlZ0V4cCIsImFycmF5IiwiQXJyYXkiLCJpc0FycmF5Iiwibm9uTnVsbE9iamVjdCIsIlN0cmluZyIsInJlcXVlc3RIb29rU3ViY2xhc3MiLCJSZXF1ZXN0SG9vayIsImNvbnN0cnVjdG9yIiwidHlwZXMiLCJjYWxsc2l0ZU5hbWUiLCJ3aGF0IiwicGFzcyIsImFjdHVhbFR5cGUiLCJhY3R1YWxNc2ciLCJleHBlY3RlZFR5cGVNc2ciLCJsYXN0IiwibGVuZ3RoIiwiZm9yRWFjaCIsImkiLCJBUElFcnJvciIsIk1FU1NBR0UiLCJpbnZhbGlkVmFsdWVUeXBlIiwiR2VuZXJhbEVycm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O1FBeUZnQkEsVSxHQUFBQSxVOztBQXpGaEI7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0FBRUEsTUFBTUMsc0JBQXNCLFdBQTVCOztBQUVBLFNBQVNDLG9CQUFULENBQStCQyxJQUEvQixFQUFxQztBQUNqQyxXQUFPRixvQkFBb0JHLElBQXBCLENBQXlCRCxJQUF6QixJQUFpQyxJQUFqQyxHQUF3QyxHQUEvQztBQUNIOztBQUVE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UTdCLEtBQUtNLFNBQUwsQ0FBZVIsS0FBZixFQUFzQmdDLFVBQXRCLENBQWY7O0FBRUEsWUFBSTlCLEtBQUtRLGlCQUFULEVBQ0l1QixZQUFZL0IsS0FBS1EsaUJBQUwsQ0FBdUJWLEtBQXZCLEVBQThCZ0MsVUFBOUIsQ0FBWjs7QUFFSixZQUFJTSxNQUFNLENBQVYsRUFDSUosbUJBQW1CaEMsS0FBS0ssSUFBeEIsQ0FESixLQUdJMkIsbUJBQW1CLENBQUNJLE1BQU1ILElBQU4sR0FBYSxTQUFTdkMscUJBQXFCTSxLQUFLSyxJQUExQixDQUFULEdBQTJDLEdBQXhELEdBQThELElBQS9ELElBQXVFTCxLQUFLSyxJQUEvRjtBQUNQLEtBVkQ7O0FBWUEsUUFBSSxDQUFDd0IsSUFBTCxFQUFXO0FBQ1AsY0FBTUYsZUFDRixJQUFJVSxVQUFKLENBQWFWLFlBQWIsRUFBMkJXLGtCQUFRQyxnQkFBbkMsRUFBcURYLElBQXJELEVBQTJESSxlQUEzRCxFQUE0RUQsU0FBNUUsQ0FERSxHQUVGLElBQUlTLGNBQUosQ0FBaUJGLGtCQUFRQyxnQkFBekIsRUFBMkNYLElBQTNDLEVBQWlESSxlQUFqRCxFQUFrRUQsU0FBbEUsQ0FGSjtBQUdIO0FBQ0oiLCJmaWxlIjoiZXJyb3JzL3J1bnRpbWUvdHlwZS1hc3NlcnRpb25zLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNGaW5pdGUgYXMgaXNGaW5pdGVOdW1iZXIsIGlzUmVnRXhwLCBpc05pbCBhcyBpc051bGxPclVuZGVmaW5lZCB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBBUElFcnJvciwgR2VuZXJhbEVycm9yIH0gZnJvbSAnLi8nO1xuaW1wb3J0IE1FU1NBR0UgZnJvbSAnLi9tZXNzYWdlJztcbmltcG9ydCBSZXF1ZXN0SG9vayBmcm9tICcuLi8uLi9hcGkvcmVxdWVzdC1ob29rcy9ob29rJztcblxuY29uc3QgU1RBUlRfRlJPTV9WT1dFTF9SRSA9IC9eW2FlaW91XS9pO1xuXG5mdW5jdGlvbiBnZXRJbmRlZmluaXRlQXJ0aWNsZSAodGV4dCkge1xuICAgIHJldHVybiBTVEFSVF9GUk9NX1ZPV0VMX1JFLnRlc3QodGV4dCkgPyAnYW4nIDogJ2EnO1xufVxuXG5mdW5jdGlvbiBpc05vbk5lZ2F0aXZlVmFsdWUgKHZhbHVlKSB7XG4gICAgcmV0dXJuIGlzRmluaXRlTnVtYmVyKHZhbHVlKSAmJiB2YWx1ZSA+PSAwO1xufVxuXG5mdW5jdGlvbiBnZXROdW1iZXJUeXBlQWN0dWFsVmFsdWVNc2cgKHZhbHVlLCB0eXBlKSB7XG4gICAgaWYgKHR5cGUgIT09ICdudW1iZXInKVxuICAgICAgICByZXR1cm4gdHlwZTtcblxuICAgIGlmIChOdW1iZXIuaXNOYU4odmFsdWUpKVxuICAgICAgICByZXR1cm4gTmFOO1xuXG4gICAgaWYgKCFpc0Zpbml0ZU51bWJlcih2YWx1ZSkpXG4gICAgICAgIHJldHVybiBJbmZpbml0eTtcblxuICAgIHJldHVybiB2YWx1ZTtcbn1cblxuZXhwb3J0IHZhciBpcyA9IHtcbiAgICBudW1iZXI6IHtcbiAgICAgICAgbmFtZTogICAgICAgICAgICAgICdudW1iZXInLFxuICAgICAgICBwcmVkaWNhdGU6ICAgICAgICAgaXNGaW5pdGVOdW1iZXIsXG4gICAgICAgIGdldEFjdHVhbFZhbHVlTXNnOiBnZXROdW1iZXJUeXBlQWN0dWFsVmFsdWVNc2dcbiAgICB9LFxuXG4gICAgbm9uTmVnYXRpdmVOdW1iZXI6IHtcbiAgICAgICAgbmFtZTogICAgICAgICAgICAgICdub24tbmVnYXRpdmUgbnVtYmVyJyxcbiAgICAgICAgcHJlZGljYXRlOiAgICAgICAgIGlzTm9uTmVnYXRpdmVWYWx1ZSxcbiAgICAgICAgZ2V0QWN0dWFsVmFsdWVNc2c6IGdldE51bWJlclR5cGVBY3R1YWxWYWx1ZU1zZ1xuICAgIH0sXG5cbiAgICBub25OZWdhdGl2ZU51bWJlclN0cmluZzoge1xuICAgICAgICBuYW1lOiAgICAgICdub24tbmVnYXRpdmUgbnVtYmVyJyxcbiAgICAgICAgcHJlZGljYXRlOiB2YWx1ZSA9PiBpc05vbk5lZ2F0aXZlVmFsdWUocGFyc2VJbnQodmFsdWUsIDEwKSksXG5cbiAgICAgICAgZ2V0QWN0dWFsVmFsdWVNc2c6IHZhbHVlID0+IHtcbiAgICAgICAgICAgIHZhciBudW1iZXIgPSBwYXJzZUludCh2YWx1ZSwgMTApO1xuXG4gICAgICAgICAgICByZXR1cm4gaXNOYU4obnVtYmVyKSA/IEpTT04uc3RyaW5naWZ5KHZhbHVlKSA6IG51bWJlcjtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBib29sZWFuOiB7XG4gICAgICAgIG5hbWU6ICAgICAgJ2Jvb2xlYW4nLFxuICAgICAgICBwcmVkaWNhdGU6ICh2YWx1ZSwgdHlwZSkgPT4gdHlwZSA9PT0gJ2Jvb2xlYW4nXG4gICAgfSxcblxuICAgIHN0cmluZzoge1xuICAgICAgICBuYW1lOiAgICAgICdzdHJpbmcnLFxuICAgICAgICBwcmVkaWNhdGU6ICh2YWx1ZSwgdHlwZSkgPT4gdHlwZSA9PT0gJ3N0cmluZydcbiAgICB9LFxuXG4gICAgZnVuY3Rpb246IHtcbiAgICAgICAgbmFtZTogICAgICAnZnVuY3Rpb24nLFxuICAgICAgICBwcmVkaWNhdGU6ICh2YWx1ZSwgdHlwZSkgPT4gdHlwZSA9PT0gJ2Z1bmN0aW9uJ1xuICAgIH0sXG5cbiAgICByZWdFeHA6IHtcbiAgICAgICAgbmFtZTogICAgICAncmVndWxhciBleHByZXNzaW9uJyxcbiAgICAgICAgcHJlZGljYXRlOiBpc1JlZ0V4cFxuICAgIH0sXG5cbiAgICBhcnJheToge1xuICAgICAgICBuYW1lOiAgICAgICdhcnJheScsXG4gICAgICAgIHByZWRpY2F0ZTogdmFsdWUgPT4gQXJyYXkuaXNBcnJheSh2YWx1ZSlcbiAgICB9LFxuXG4gICAgbm9uTnVsbE9iamVjdDoge1xuICAgICAgICBuYW1lOiAgICAgICAgICAgICAgJ25vbi1udWxsIG9iamVjdCcsXG4gICAgICAgIHByZWRpY2F0ZTogICAgICAgICAodmFsdWUsIHR5cGUpID0+IHR5cGUgPT09ICdvYmplY3QnICYmICFpc051bGxPclVuZGVmaW5lZCh2YWx1ZSksXG4gICAgICAgIGdldEFjdHVhbFZhbHVlTXNnOiAodmFsdWUsIHR5cGUpID0+IGlzTnVsbE9yVW5kZWZpbmVkKHZhbHVlKSA/IFN0cmluZyh2YWx1ZSkgOiB0eXBlXG4gICAgfSxcblxuICAgIHJlcXVlc3RIb29rU3ViY2xhc3M6IHtcbiAgICAgICAgbmFtZTogICAgICAnUmVxdWVzdEhvb2sgc3ViY2xhc3MnLFxuICAgICAgICBwcmVkaWNhdGU6IHZhbHVlID0+IHZhbHVlIGluc3RhbmNlb2YgUmVxdWVzdEhvb2sgJiYgdmFsdWUuY29uc3RydWN0b3IgJiYgdmFsdWUuY29uc3RydWN0b3IgIT09IFJlcXVlc3RIb29rXG4gICAgfVxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydFR5cGUgKHR5cGVzLCBjYWxsc2l0ZU5hbWUsIHdoYXQsIHZhbHVlKSB7XG4gICAgdHlwZXMgPSBBcnJheS5pc0FycmF5KHR5cGVzKSA/IHR5cGVzIDogW3R5cGVzXTtcblxuICAgIHZhciBwYXNzICAgICAgICAgICAgPSBmYWxzZTtcbiAgICB2YXIgYWN0dWFsVHlwZSAgICAgID0gdHlwZW9mIHZhbHVlO1xuICAgIHZhciBhY3R1YWxNc2cgICAgICAgPSBhY3R1YWxUeXBlO1xuICAgIHZhciBleHBlY3RlZFR5cGVNc2cgPSAnJztcbiAgICB2YXIgbGFzdCAgICAgICAgICAgID0gdHlwZXMubGVuZ3RoIC0gMTtcblxuICAgIHR5cGVzLmZvckVhY2goKHR5cGUsIGkpID0+IHtcbiAgICAgICAgcGFzcyA9IHBhc3MgfHwgdHlwZS5wcmVkaWNhdGUodmFsdWUsIGFjdHVhbFR5cGUpO1xuXG4gICAgICAgIGlmICh0eXBlLmdldEFjdHVhbFZhbHVlTXNnKVxuICAgICAgICAgICAgYWN0dWFsTXNnID0gdHlwZS5nZXRBY3R1YWxWYWx1ZU1zZyh2YWx1ZSwgYWN0dWFsVHlwZSk7XG5cbiAgICAgICAgaWYgKGkgPT09IDApXG4gICAgICAgICAgICBleHBlY3RlZFR5cGVNc2cgKz0gdHlwZS5uYW1lO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBleHBlY3RlZFR5cGVNc2cgKz0gKGkgPT09IGxhc3QgPyAnIG9yICcgKyBnZXRJbmRlZmluaXRlQXJ0aWNsZSh0eXBlLm5hbWUpICsgJyAnIDogJywgJykgKyB0eXBlLm5hbWU7XG4gICAgfSk7XG5cbiAgICBpZiAoIXBhc3MpIHtcbiAgICAgICAgdGhyb3cgY2FsbHNpdGVOYW1lID9cbiAgICAgICAgICAgIG5ldyBBUElFcnJvcihjYWxsc2l0ZU5hbWUsIE1FU1NBR0UuaW52YWxpZFZhbHVlVHlwZSwgd2hhdCwgZXhwZWN0ZWRUeXBlTXNnLCBhY3R1YWxNc2cpIDpcbiAgICAgICAgICAgIG5ldyBHZW5lcmFsRXJyb3IoTUVTU0FHRS5pbnZhbGlkVmFsdWVUeXBlLCB3aGF0LCBleHBlY3RlZFR5cGVNc2csIGFjdHVhbE1zZyk7XG4gICAgfVxufVxuIl19
