'use strict';

exports.__esModule = true;

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _from = require('babel-runtime/core-js/array/from');

var _from2 = _interopRequireDefault(_from);

var _create = require('babel-runtime/core-js/object/create');

var _create2 = _interopRequireDefault(_create);

var _events = require('events');

var _events2 = _interopRequireDefault(_events);

var _lodash = require('lodash');

var _readFileRelative = require('read-file-relative');

var _promisifyEvent = require('promisify-event');

var _promisifyEvent2 = _interopRequireDefault(_promisifyEvent);

var _pinkie = require('pinkie');

var _pinkie2 = _interopRequireDefault(_pinkie);

var _mustache = require('mustache');

var _mustache2 = _interopRequireDefault(_mustache);

var _debugLogger = require('../notifications/debug-logger');

var _debugLogger2 = _interopRequireDefault(_debugLogger);

var _sessionController = require('./session-controller');

var _sessionController2 = _interopRequireDefault(_sessionController);

var _debugLog = require('./debug-log');

var _debugLog2 = _interopRequireDefault(_debugLog);

var _formattableAdapter = require('../errors/test-run/formattable-adapter');

var _formattableAdapter2 = _interopRequireDefault(_formattableAdapter);

var _errorList = require('../errors/error-list');

var _errorList2 = _interopRequireDefault(_errorList);

var _executeJsExpression = require('./execute-js-expression');

var _testRun = require('../errors/test-run/');

var _browserManipulationQueue = require('./browser-manipulation-queue');

var _browserManipulationQueue2 = _interopRequireDefault(_browserManipulationQueue);

var _phase = require('./phase');

var _phase2 = _interopRequireDefault(_phase);

var _clientMessages = require('./client-messages');

var _clientMessages2 = _interopRequireDefault(_clientMessages);

var _type = require('./commands/type');

var _type2 = _interopRequireDefault(_type);

var _executor = require('../assertions/executor');

var _executor2 = _interopRequireDefault(_executor);

var _delay = require('../utils/delay');

var _delay2 = _interopRequireDefault(_delay);

var _markerSymbol = require('./marker-symbol');

var _markerSymbol2 = _interopRequireDefault(_markerSymbol);

var _testRunTracker = require('../api/test-run-tracker');

var _testRunTracker2 = _interopRequireDefault(_testRunTracker);

var _phase3 = require('../role/phase');

var _phase4 = _interopRequireDefault(_phase3);

var _bookmark = require('./bookmark');

var _bookmark2 = _interopRequireDefault(_bookmark);

var _clientFunctionBuilder = require('../client-functions/client-function-builder');

var _clientFunctionBuilder2 = _interopRequireDefault(_clientFunctionBuilder);

var _pluginHost = require('../reporter/plugin-host');

var _pluginHost2 = _interopRequireDefault(_pluginHost);

var _browserConsoleMessages = require('./browser-console-messages');

var _browserConsoleMessages2 = _interopRequireDefault(_browserConsoleMessages);

var _browserManipulation = require('./commands/browser-manipulation');

var _actions = require('./commands/actions');

var _service = require('./commands/service');

var _utils = require('./commands/utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

//Const
const TEST_RUN_TEMPLATE = (0, _readFileRelative.readSync)('../client/test-run/index.js.mustache');
const IFRAME_TEST_RUN_TEMPLATE = (0, _readFileRelative.readSync)('../client/test-run/iframe.js.mustache');
const TEST_DONE_CONFIRMATION_RESPONSE = 'test-done-confirmation';
const MAX_RESPONSE_DELAY = 2 * 60 * 1000;

const ALL_DRIVER_TASKS_ADDED_TO_QUEUE_EVENT = 'all-driver-tasks-added-to-queue';

class TestRun extends _events2.default {
    constructor(test, browserConnection, screenshotCapturer, warningLog, opts) {
        super();

        this[_markerSymbol2.default] = true;

        this.opts = opts;
        this.test = test;
        this.browserConnection = browserConnection;

        this.phase = _phase2.default.initial;

        this.driverTaskQueue = [];
        this.testDoneCommandQueued = false;

        this.activeDialogHandler = null;
        this.activeIframeSelector = null;
        this.speed = this.opts.speed;
        this.pageLoadTimeout = this.opts.pageLoadTimeout;

        this.disablePageReloads = test.disablePageReloads || opts.disablePageReloads && test.disablePageReloads !== false;

        this.session = _sessionController2.default.getSession(this);

        this.consoleMessages = new _browserConsoleMessages2.default();

        this.pendingRequest = null;
        this.pendingPageError = null;

        this.controller = null;
        this.ctx = (0, _create2.default)(null);
        this.fixtureCtx = null;

        this.currentRoleId = null;
        this.usedRoleStates = (0, _create2.default)(null);

        this.errs = [];

        this.lastDriverStatusId = null;
        this.lastDriverStatusResponse = null;

        this.fileDownloadingHandled = false;
        this.resolveWaitForFileDownloadingPromise = null;

        this.addingDriverTasksCount = 0;

        this.debugging = this.opts.debugMode;
        this.debugOnFail = this.opts.debugOnFail;
        this.disableDebugBreakpoints = false;
        this.debugReporterPluginHost = new _pluginHost2.default({ noColors: false });

        this.browserManipulationQueue = new _browserManipulationQueue2.default(browserConnection, screenshotCapturer, warningLog);

        this.debugLog = new _debugLog2.default(this.browserConnection.userAgent);

        this.quarantine = null;

        this.warningLog = warningLog;

        this.injectable.scripts.push('/testcafe-core.js');
        this.injectable.scripts.push('/testcafe-ui.js');
        this.injectable.scripts.push('/testcafe-automation.js');
        this.injectable.scripts.push('/testcafe-driver.js');
        this.injectable.styles.push('/testcafe-ui-styles.css');

        this.requestHooks = (0, _from2.default)(this.test.requestHooks);

        this._initRequestHooks();
    }

    get id() {
        return this.session.id;
    }

    get injectable() {
        return this.session.injectable;
    }

    addQuarantineInfo(quarantine) {
        this.quarantine = quarantine;
    }

    addRequestHook(hook) {
        if (this.requestHooks.indexOf(hook) !== -1) return;

        this.requestHooks.push(hook);
        this._initRequestHook(hook);
    }

    removeRequestHook(hook) {
        if (this.requestHooks.indexOf(hook) === -1) return;

        (0, _lodash.pull)(this.requestHooks, hook);
        this._disposeRequestHook(hook);
    }

    _initRequestHook(hook) {
        hook.warningLog = this.warningLog;

        hook._instantiateRequestFilterRules();
        hook._instantiatedRequestFilterRules.forEach(rule => {
            this.session.addRequestEventListeners(rule, {
                onRequest: hook.onRequest.bind(hook),
                onConfigureResponse: hook._onConfigureResponse.bind(hook),
                onResponse: hook.onResponse.bind(hook)
            });
        });
    }

    _disposeRequestHook(hook) {
        hook.warningLog = null;

        hook._instantiatedRequestFilterRules.forEach(rule => {
            this.session.removeRequestEventListeners(rule);
        });
    }

    _initRequestHooks() {
        this.requestHooks.forEach(hook => this._initRequestHook(hook));
    }

    // Hammerhead payload
    _getPayloadScript() {
        this.fileDownloadingHandled = false;
        this.resolveWaitForFileDownloadingPromise = null;

        return _mustache2.default.render(TEST_RUN_TEMPLATE, {
            testRunId: (0, _stringify2.default)(this.session.id),
            browserId: (0, _stringify2.default)(this.browserConnection.id),
            browserHeartbeatRelativeUrl: (0, _stringify2.default)(this.browserConnection.heartbeatRelativeUrl),
            browserStatusRelativeUrl: (0, _stringify2.default)(this.browserConnection.statusRelativeUrl),
            browserStatusDoneRelativeUrl: (0, _stringify2.default)(this.browserConnection.statusDoneRelativeUrl),
            userAgent: (0, _stringify2.default)(this.browserConnection.userAgent),
            testName: (0, _stringify2.default)(this.test.name),
            fixtureName: (0, _stringify2.default)(this.test.fixture.name),
            selectorTimeout: this.opts.selectorTimeout,
            pageLoadTimeout: this.pageLoadTimeout,
            skipJsErrors: this.opts.skipJsErrors,
            speed: this.speed,
            dialogHandler: (0, _stringify2.default)(this.activeDialogHandler)
        });
    }

    _getIframePayloadScript() {
        return _mustache2.default.render(IFRAME_TEST_RUN_TEMPLATE, {
            testRunId: (0, _stringify2.default)(this.session.id),
            selectorTimeout: this.opts.selectorTimeout,
            pageLoadTimeout: this.pageLoadTimeout,
            speed: this.speed,
            dialogHandler: (0, _stringify2.default)(this.activeDialogHandler)
        });
    }

    // Hammerhead handlers
    getAuthCredentials() {
        return this.test.authCredentials;
    }

    handleFileDownload() {
        if (this.resolveWaitForFileDownloadingPromise) {
            this.resolveWaitForFileDownloadingPromise(true);
            this.resolveWaitForFileDownloadingPromise = null;
        } else this.fileDownloadingHandled = true;
    }

    handlePageError(ctx, err) {
        this.pendingPageError = new _testRun.PageLoadError(err);

        ctx.redirect(ctx.toProxyUrl('about:error'));
    }

    // Test function execution
    _executeTestFn(phase, fn) {
        var _this = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _this.phase = phase;

            try {
                yield fn(_this);
            } catch (err) {
                var screenshotPath = null;

                if (_this.opts.takeScreenshotsOnFails) screenshotPath = yield _this.executeCommand(new _browserManipulation.TakeScreenshotOnFailCommand());

                _this.addError(err, screenshotPath);
                return false;
            }

            return !_this._addPendingPageErrorIfAny();
        })();
    }

    _runBeforeHook() {
        var _this2 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this2.test.beforeFn) return yield _this2._executeTestFn(_phase2.default.inTestBeforeHook, _this2.test.beforeFn);

            if (_this2.test.fixture.beforeEachFn) return yield _this2._executeTestFn(_phase2.default.inFixtureBeforeEachHook, _this2.test.fixture.beforeEachFn);

            return true;
        })();
    }

    _runAfterHook() {
        var _this3 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this3.test.afterFn) return yield _this3._executeTestFn(_phase2.default.inTestAfterHook, _this3.test.afterFn);

            if (_this3.test.fixture.afterEachFn) return yield _this3._executeTestFn(_phase2.default.inFixtureAfterEachHook, _this3.test.fixture.afterEachFn);

            return true;
        })();
    }

    start() {
        var _this4 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _testRunTracker2.default.activeTestRuns[_this4.session.id] = _this4;

            _this4.emit('start');

            if (yield _this4._runBeforeHook()) {
                yield _this4._executeTestFn(_phase2.default.inTest, _this4.test.fn);
                yield _this4._runAfterHook();
            }

            if (_this4.errs.length && _this4.debugOnFail) yield _this4._enqueueSetBreakpointCommand(null, _this4.debugReporterPluginHost.formatError(_this4.errs[0]));

            yield _this4.executeCommand(new _service.TestDoneCommand());
            _this4._addPendingPageErrorIfAny();

            delete _testRunTracker2.default.activeTestRuns[_this4.session.id];

            _this4.emit('done');
        })();
    }

    _evaluate(code) {
        try {
            return (0, _executeJsExpression.executeJsExpression)(code, this, { skipVisibilityCheck: false });
        } catch (err) {
            return { err };
        }
    }

    // Errors
    _addPendingPageErrorIfAny() {
        if (this.pendingPageError) {
            this.addError(this.pendingPageError);
            this.pendingPageError = null;
            return true;
        }

        return false;
    }

    addError(err, screenshotPath) {
        var errList = err instanceof _errorList2.default ? err.items : [err];

        errList.forEach(item => {
            var adapter = new _formattableAdapter2.default(item, {
                userAgent: this.browserConnection.userAgent,
                screenshotPath: screenshotPath || '',
                testRunPhase: this.phase
            });

            this.errs.push(adapter);
        });
    }

    // Task queue
    _enqueueCommand(command, callsite) {
        if (this.pendingRequest) this._resolvePendingRequest(command);

        return new _pinkie2.default((resolve, reject) => {
            this.addingDriverTasksCount--;
            this.driverTaskQueue.push({ command, resolve, reject, callsite });

            if (!this.addingDriverTasksCount) this.emit(ALL_DRIVER_TASKS_ADDED_TO_QUEUE_EVENT, this.driverTaskQueue.length);
        });
    }

    get driverTaskQueueLength() {
        return this.addingDriverTasksCount ? (0, _promisifyEvent2.default)(this, ALL_DRIVER_TASKS_ADDED_TO_QUEUE_EVENT) : _pinkie2.default.resolve(this.driverTaskQueue.length);
    }

    _enqueueBrowserConsoleMessagesCommand(command, callsite) {
        var _this5 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            yield _this5._enqueueCommand(command, callsite);

            return _this5.consoleMessages.getCopy();
        })();
    }

    _enqueueSetBreakpointCommand(callsite, error) {
        var _this6 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _debugLogger2.default.showBreakpoint(_this6.session.id, _this6.browserConnection.userAgent, callsite, error);

            _this6.debugging = yield _this6.executeCommand(new _service.SetBreakpointCommand(!!error), callsite);
        })();
    }

    _removeAllNonServiceTasks() {
        this.driverTaskQueue = this.driverTaskQueue.filter(driverTask => (0, _utils.isServiceCommand)(driverTask.command));

        this.browserManipulationQueue.removeAllNonServiceManipulations();
    }

    // Current driver task
    get currentDriverTask() {
        return this.driverTaskQueue[0];
    }

    _resolveCurrentDriverTask(result) {
        this.currentDriverTask.resolve(result);
        this.driverTaskQueue.shift();

        if (this.testDoneCommandQueued) this._removeAllNonServiceTasks();
    }

    _rejectCurrentDriverTask(err) {
        err.callsite = err.callsite || this.driverTaskQueue[0].callsite;
        err.isRejectedDriverTask = true;

        this.currentDriverTask.reject(err);
        this._removeAllNonServiceTasks();
    }

    // Pending request
    _clearPendingRequest() {
        if (this.pendingRequest) {
            clearTimeout(this.pendingRequest.responseTimeout);
            this.pendingRequest = null;
        }
    }

    _resolvePendingRequest(command) {
        this.lastDriverStatusResponse = command;
        this.pendingRequest.resolve(command);
        this._clearPendingRequest();
    }

    // Handle driver request
    _fulfillCurrentDriverTask(driverStatus) {
        if (driverStatus.executionError) this._rejectCurrentDriverTask(driverStatus.executionError);else this._resolveCurrentDriverTask(driverStatus.result);
    }

    _handlePageErrorStatus(pageError) {
        if (this.currentDriverTask && (0, _utils.isCommandRejectableByPageError)(this.currentDriverTask.command)) {
            this._rejectCurrentDriverTask(pageError);
            this.pendingPageError = null;

            return true;
        }

        this.pendingPageError = this.pendingPageError || pageError;

        return false;
    }

    _handleDriverRequest(driverStatus) {
        var pageError = this.pendingPageError || driverStatus.pageError;

        var currentTaskRejectedByError = pageError && this._handlePageErrorStatus(pageError);

        this.consoleMessages.concat(driverStatus.consoleMessages);

        if (!currentTaskRejectedByError && driverStatus.isCommandResult) {
            if (this.currentDriverTask.command.type === _type2.default.testDone) {
                this._resolveCurrentDriverTask();

                return TEST_DONE_CONFIRMATION_RESPONSE;
            }

            this._fulfillCurrentDriverTask(driverStatus);
        }

        return this._getCurrentDriverTaskCommand();
    }

    _getCurrentDriverTaskCommand() {
        if (!this.currentDriverTask) return null;

        const command = this.currentDriverTask.command;

        if (command.type === _type2.default.navigateTo && command.stateSnapshot) this.session.useStateSnapshot(JSON.parse(command.stateSnapshot));

        return command;
    }

    // Execute command
    static _shouldAddCommandToQueue(command) {
        return command.type !== _type2.default.wait && command.type !== _type2.default.setPageLoadTimeout && command.type !== _type2.default.debug && command.type !== _type2.default.useRole && command.type !== _type2.default.assertion;
    }

    _executeExpression(command) {
        var _this7 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var expression = command.expression,
                resultVariableName = command.resultVariableName,
                isAsyncExpression = command.isAsyncExpression;


            if (isAsyncExpression) expression = `await ${expression}`;

            if (resultVariableName) expression = `${resultVariableName} = ${expression}, ${resultVariableName}`;

            if (isAsyncExpression) expression = `(async () => { return ${expression}; }).apply(this);`;

            var result = _this7._evaluate(expression);

            return isAsyncExpression ? yield result : result;
        })();
    }

    _executeAssertion(command, callsite) {
        var _this8 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var assertionTimeout = command.options.timeout === void 0 ? _this8.opts.assertionTimeout : command.options.timeout;
            var executor = new _executor2.default(command, assertionTimeout, callsite);

            executor.once('start-assertion-retries', function (timeout) {
                return _this8.executeCommand(new _service.ShowAssertionRetriesStatusCommand(timeout));
            });
            executor.once('end-assertion-retries', function (success) {
                return _this8.executeCommand(new _service.HideAssertionRetriesStatusCommand(success));
            });

            return executor.run();
        })();
    }

    _adjustConfigurationWithCommand(command) {
        if (command.type === _type2.default.testDone) {
            this.testDoneCommandQueued = true;
            _debugLogger2.default.hideBreakpoint(this.session.id);
        } else if (command.type === _type2.default.setNativeDialogHandler) this.activeDialogHandler = command.dialogHandler;else if (command.type === _type2.default.switchToIframe) this.activeIframeSelector = command.selector;else if (command.type === _type2.default.switchToMainWindow) this.activeIframeSelector = null;else if (command.type === _type2.default.setTestSpeed) this.speed = command.speed;else if (command.type === _type2.default.setPageLoadTimeout) this.pageLoadTimeout = command.duration;else if (command.type === _type2.default.debug) this.debugging = true;
    }

    _adjustScreenshotCommand(command) {
        var _this9 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const browserId = _this9.browserConnection.id;

            var _ref = yield _this9.browserConnection.provider.hasCustomActionForBrowser(browserId);

            const hasChromelessScreenshots = _ref.hasChromelessScreenshots;


            if (!hasChromelessScreenshots) command.generateScreenshotMark();
        })();
    }

    _setBreakpointIfNecessary(command, callsite) {
        var _this10 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (!_this10.disableDebugBreakpoints && _this10.debugging && (0, _utils.canSetDebuggerBreakpointBeforeCommand)(command)) yield _this10._enqueueSetBreakpointCommand(callsite);
        })();
    }

    executeCommand(command, callsite) {
        var _this11 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _this11.debugLog.command(command);

            if (_this11.pendingPageError && (0, _utils.isCommandRejectableByPageError)(command)) return _this11._rejectCommandWithPageError(callsite);

            if (TestRun._shouldAddCommandToQueue(command)) _this11.addingDriverTasksCount++;

            _this11._adjustConfigurationWithCommand(command);

            yield _this11._setBreakpointIfNecessary(command, callsite);

            if ((0, _utils.isScreenshotCommand)(command)) yield _this11._adjustScreenshotCommand(command);

            if ((0, _utils.isBrowserManipulationCommand)(command)) _this11.browserManipulationQueue.push(command);

            if (command.type === _type2.default.wait) return (0, _delay2.default)(command.timeout);

            if (command.type === _type2.default.setPageLoadTimeout) return null;

            if (command.type === _type2.default.debug) return yield _this11._enqueueSetBreakpointCommand(callsite);

            if (command.type === _type2.default.useRole) return yield _this11._useRole(command.role, callsite);

            if (command.type === _type2.default.assertion) return _this11._executeAssertion(command, callsite);

            if (command.type === _type2.default.executeExpression) return yield _this11._executeExpression(command, callsite);

            if (command.type === _type2.default.getBrowserConsoleMessages) return yield _this11._enqueueBrowserConsoleMessagesCommand(command, callsite);

            return _this11._enqueueCommand(command, callsite);
        })();
    }

    _rejectCommandWithPageError(callsite) {
        var err = this.pendingPageError;

        err.callsite = callsite;
        this.pendingPageError = null;

        return _pinkie2.default.reject(err);
    }

    // Role management
    getStateSnapshot() {
        var _this12 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var state = _this12.session.getStateSnapshot();

            state.storages = yield _this12.executeCommand(new _service.BackupStoragesCommand());

            return state;
        })();
    }

    switchToCleanRun() {
        var _this13 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _this13.ctx = (0, _create2.default)(null);
            _this13.fixtureCtx = (0, _create2.default)(null);
            _this13.consoleMessages = new _browserConsoleMessages2.default();

            _this13.session.useStateSnapshot(null);

            if (_this13.activeDialogHandler) {
                var removeDialogHandlerCommand = new _actions.SetNativeDialogHandlerCommand({ dialogHandler: { fn: null } });

                yield _this13.executeCommand(removeDialogHandlerCommand);
            }

            if (_this13.speed !== _this13.opts.speed) {
                var setSpeedCommand = new _actions.SetTestSpeedCommand({ speed: _this13.opts.speed });

                yield _this13.executeCommand(setSpeedCommand);
            }

            if (_this13.pageLoadTimeout !== _this13.opts.pageLoadTimeout) {
                var setPageLoadTimeoutCommand = new _actions.SetPageLoadTimeoutCommand({ duration: _this13.opts.pageLoadTimeout });

                yield _this13.executeCommand(setPageLoadTimeoutCommand);
            }
        })();
    }

    _getStateSnapshotFromRole(role) {
        var _this14 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var prevPhase = _this14.phase;

            _this14.phase = _phase2.default.inRoleInitializer;

            if (role.phase === _phase4.default.uninitialized) yield role.initialize(_this14);else if (role.phase === _phase4.default.pendingInitialization) yield (0, _promisifyEvent2.default)(role, 'initialized');

            if (role.initErr) throw role.initErr;

            _this14.phase = prevPhase;

            return role.stateSnapshot;
        })();
    }

    _useRole(role, callsite) {
        var _this15 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this15.phase === _phase2.default.inRoleInitializer) throw new _testRun.RoleSwitchInRoleInitializerError(callsite);

            _this15.disableDebugBreakpoints = true;

            var bookmark = new _bookmark2.default(_this15, role);

            yield bookmark.init();

            if (_this15.currentRoleId) _this15.usedRoleStates[_this15.currentRoleId] = yield _this15.getStateSnapshot();

            var stateSnapshot = _this15.usedRoleStates[role.id] || (yield _this15._getStateSnapshotFromRole(role));

            _this15.session.useStateSnapshot(stateSnapshot);

            _this15.currentRoleId = role.id;

            yield bookmark.restore(callsite, stateSnapshot);

            _this15.disableDebugBreakpoints = false;
        })();
    }

    // Get current URL
    getCurrentUrl() {
        var _this16 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var builder = new _clientFunctionBuilder2.default(function () {
                /* eslint-disable no-undef */
                return window.location.href;
                /* eslint-enable no-undef */
            }, { boundTestRun: _this16 });

            var getLocation = builder.getFunction();

            return yield getLocation();
        })();
    }
}

exports.default = TestRun; // Service message handlers

var ServiceMessages = TestRun.prototype;

ServiceMessages[_clientMessages2.default.ready] = function (msg) {
    this.debugLog.driverMessage(msg);

    this._clearPendingRequest();

    // NOTE: the driver sends the status for the second time if it didn't get a response at the
    // first try. This is possible when the page was unloaded after the driver sent the status.
    if (msg.status.id === this.lastDriverStatusId) return this.lastDriverStatusResponse;

    this.lastDriverStatusId = msg.status.id;
    this.lastDriverStatusResponse = this._handleDriverRequest(msg.status);

    if (this.lastDriverStatusResponse) return this.lastDriverStatusResponse;

    // NOTE: browsers abort an opened xhr request after a certain timeout (the actual duration depends on the browser).
    // To avoid this, we send an empty response after 2 minutes if we didn't get any command.
    var responseTimeout = setTimeout(() => this._resolvePendingRequest(null), MAX_RESPONSE_DELAY);

    return new _pinkie2.default((resolve, reject) => {
        this.pendingRequest = { resolve, reject, responseTimeout };
    });
};

ServiceMessages[_clientMessages2.default.readyForBrowserManipulation] = (() => {
    var _ref2 = (0, _asyncToGenerator3.default)(function* (msg) {
        this.debugLog.driverMessage(msg);

        var result = null;
        var error = null;

        try {
            result = yield this.browserManipulationQueue.executePendingManipulation(msg);
        } catch (err) {
            error = err;
        }

        return { result, error };
    });

    return function (_x) {
        return _ref2.apply(this, arguments);
    };
})();

ServiceMessages[_clientMessages2.default.waitForFileDownload] = function (msg) {
    this.debugLog.driverMessage(msg);

    return new _pinkie2.default(resolve => {
        if (this.fileDownloadingHandled) {
            this.fileDownloadingHandled = false;
            resolve(true);
        } else this.resolveWaitForFileDownloadingPromise = resolve;
    });
};
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0LXJ1bi9pbmRleC5qcyJdLCJuYW1lcyI6WyJURVNUX1JVTl9URU1QTEFURSIsIklGUkFNRV9URVNUX1JVTl9URU1QTEFURSIsIlRFU1RfRE9ORV9DT05GSVJNQVRJT05fUkVTUE9OU0UiLCJNQVhfUkVTUE9OU0VfREVMQVkiLCJBTExfRFJJVkVSX1RBU0tTX0FEREVEX1RPX1FVRVVFX0VWRU5UIiwiVGVzdFJ1biIsIkV2ZW50RW1pdHRlciIsImNvbnN0cnVjdG9yIiwidGVzdCIsImJyb3dzZXJDb25uZWN0aW9uIiwic2NyZWVuc2hvdENhcHR1cmVyIiwid2FybmluZ0xvZyIsIm9wdHMiLCJ0ZXN0UnVuTWFya2VyIiwicGhhc2UiLCJQSEFTRSIsImluaXRpYWwiLCJkcml2ZXJUYXNrUXVldWUiLCJ0ZXN0RG9uZUNvbW1hbmRRdWV1ZWQiLCJhY3RpdmVEaWFsb2dIYW5kbGVyIiwiYWN0aXZlSWZyYW1lU2VsZWN0b3IiLCJzcGVlZCIsInBhZ2VMb2FkVGltZW91dCIsImRpc2FibGVQYWdlUmVsb2FkcyIsInNlc3Npb24iLCJTZXNzaW9uQ29udHJvbGxlciIsImdldFNlc3Npb24iLCJjb25zb2xlTWVzc2FnZXMiLCJCcm93c2VyQ29uc29sZU1lc3NhZ2VzIiwicGVuZGluZ1JlcXVlc3QiLCJwZW5kaW5nUGFnZUVycm9yIiwiY29udHJvbGxlciIsImN0eCIsImZpeHR1cmVDdHgiLCJjdXJyZW50Um9sZUlkIiwidXNlZFJvbGVTdGF0ZXMiLCJlcnJzIiwibGFzdERyaXZlclN0YXR1c0lkIiwibGFzdERyaXZlclN0YXR1c1Jlc3BvbnNlIiwiZmlsZURvd25sb2FkaW5nSGFuZGxlZCIsInJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSIsImFkZGluZ0RyaXZlclRhc2tzQ291bnQiLCJkZWJ1Z2dpbmciLCJkZWJ1Z01vZGUiLCJkZWJ1Z09uRmFpbCIsImRpc2FibGVEZWJ1Z0JyZWFrcG9pbnRzIiwiZGVidWdSZXBvcnRlclBsdWdpbkhvc3QiLCJSZXBvcnRlclBsdWdpbkhvc3QiLCJub0NvbG9ycyIsImJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZSIsIkJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZSIsImRlYnVnTG9nIiwiVGVzdFJ1bkRlYnVnTG9nIiwidXNlckFnZW50IiwicXVhcmFudGluZSIsImluamVjdGFibGUiLCJzY3JpcHRzIiwicHVzaCIsInN0eWxlcyIsInJlcXVlc3RIb29rcyIsIl9pbml0UmVxdWVzdEhvb2tzIiwiaWQiLCJhZGRRdWFyYW50aW5lSW5mbyIsImFkZFJlcXVlc3RIb29rIiwiaG9vayIsImluZGV4T2YiLCJfaW5pdFJlcXVlc3RIb29rIiwicmVtb3ZlUmVxdWVzdEhvb2siLCJfZGlzcG9zZVJlcXVlc3RIb29rIiwiX2luc3RhbnRpYXRlUmVxdWVzdEZpbHRlclJ1bGVzIiwiX2luc3RhbnRpYXRlZFJlcXVlc3RGaWx0ZXJSdWxlcyIsImZvckVhY2giLCJydWxlIiwiYWRkUmVxdWVzdEV2ZW50TGlzdGVuZXJzIiwib25SZXF1ZXN0IiwiYmluZCIsIm9uQ29uZmlndXJlUmVzcG9uc2UiLCJfb25Db25maWd1cmVSZXNwb25zZSIsIm9uUmVzcG9uc2UiLCJyZW1vdmVSZXF1ZXN0RXZlbnRMaXN0ZW5lcnMiLCJfZ2V0UGF5bG9hZFNjcmlwdCIsIk11c3RhY2hlIiwicmVuZGVyIiwidGVzdFJ1bklkIiwiYnJvd3NlcklkIiwiYnJvd3NlckhlYXJ0YmVhdFJlbGF0aXZlVXJsIiwiaGVhcnRiZWF0UmVsYXRpdmVVcmwiLCJicm93c2VyU3RhdHVzUmVsYXRpdmVVcmwiLCJzdGF0dXNSZWxhdGl2ZVVybCIsImJyb3dzZXJTdGF0dXNEb25lUmVsYXRpdmVVcmwiLCJzdGF0dXNEb25lUmVsYXRpdmVVcmwiLCJ0ZXN0TmFtZSIsIm5hbWUiLCJmaXh0dXJlTmFtZSIsImZpeHR1cmUiLCJzZWxlY3RvclRpbWVvdXQiLCJza2lwSnNFcnJvcnMiLCJkaWFsb2dIYW5kbGVyIiwiX2dldElmcmFtZVBheWxvYWRTY3JpcHQiLCJnZXRBdXRoQ3JlZGVudGlhbHMiLCJhdXRoQ3JlZGVudGlhbHMiLCJoYW5kbGVGaWxlRG93bmxvYWQiLCJoYW5kbGVQYWdlRXJyb3IiLCJlcnIiLCJQYWdlTG9hZEVycm9yIiwicmVkaXJlY3QiLCJ0b1Byb3h5VXJsIiwiX2V4ZWN1dGVUZXN0Rm4iLCJmbiIsInNjcmVlbnNob3RQYXRoIiwidGFrZVNjcmVlbnNob3RzT25GYWlscyIsImV4ZWN1dGVDb21tYW5kIiwiVGFrZVNjcmVlbnNob3RPbkZhaWxDb21tYW5kIiwiYWRkRXJyb3IiLCJfYWRkUGVuZGluZ1BhZ2VFcnJvcklmQW55IiwiX3J1bkJlZm9yZUhvb2siLCJiZWZvcmVGbiIsImluVGVzdEJlZm9yZUhvb2siLCJiZWZvcmVFYWNoRm4iLCJpbkZpeHR1cmVCZWZvcmVFYWNoSG9vayIsIl9ydW5BZnRlckhvb2siLCJhZnRlckZuIiwiaW5UZXN0QWZ0ZXJIb29rIiwiYWZ0ZXJFYWNoRm4iLCJpbkZpeHR1cmVBZnRlckVhY2hIb29rIiwic3RhcnQiLCJ0ZXN0UnVuVHJhY2tlciIsImFjdGl2ZVRlc3RSdW5zIiwiZW1pdCIsImluVGVzdCIsImxlbmd0aCIsIl9lbnF1ZXVlU2V0QnJlYWtwb2ludENvbW1hbmQiLCJmb3JtYXRFcnJvciIsIlRlc3REb25lQ29tbWFuZCIsIl9ldmFsdWF0ZSIsImNvZGUiLCJza2lwVmlzaWJpbGl0eUNoZWNrIiwiZXJyTGlzdCIsIlRlc3RDYWZlRXJyb3JMaXN0IiwiaXRlbXMiLCJpdGVtIiwiYWRhcHRlciIsIlRlc3RSdW5FcnJvckZvcm1hdHRhYmxlQWRhcHRlciIsInRlc3RSdW5QaGFzZSIsIl9lbnF1ZXVlQ29tbWFuZCIsImNvbW1hbmQiLCJjYWxsc2l0ZSIsIl9yZXNvbHZlUGVuZGluZ1JlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImRyaXZlclRhc2tRdWV1ZUxlbmd0aCIsIl9lbnF1ZXVlQnJvd3NlckNvbnNvbGVNZXNzYWdlc0NvbW1hbmQiLCJnZXRDb3B5IiwiZXJyb3IiLCJkZWJ1Z0xvZ2dlciIsInNob3dCcmVha3BvaW50IiwiU2V0QnJlYWtwb2ludENvbW1hbmQiLCJfcmVtb3ZlQWxsTm9uU2VydmljZVRhc2tzIiwiZmlsdGVyIiwiZHJpdmVyVGFzayIsInJlbW92ZUFsbE5vblNlcnZpY2VNYW5pcHVsYXRpb25zIiwiY3VycmVudERyaXZlclRhc2siLCJfcmVzb2x2ZUN1cnJlbnREcml2ZXJUYXNrIiwicmVzdWx0Iiwic2hpZnQiLCJfcmVqZWN0Q3VycmVudERyaXZlclRhc2siLCJpc1JlamVjdGVkRHJpdmVyVGFzayIsIl9jbGVhclBlbmRpbmdSZXF1ZXN0IiwiY2xlYXJUaW1lb3V0IiwicmVzcG9uc2VUaW1lb3V0IiwiX2Z1bGZpbGxDdXJyZW50RHJpdmVyVGFzayIsImRyaXZlclN0YXR1cyIsImV4ZWN1dGlvbkVycm9yIiwiX2hhbmRsZVBhZ2VFcnJvclN0YXR1cyIsInBhZ2VFcnJvciIsIl9oYW5kbGVEcml2ZXJSZXF1ZXN0IiwiY3VycmVudFRhc2tSZWplY3RlZEJ5RXJyb3IiLCJjb25jYXQiLCJpc0NvbW1hbmRSZXN1bHQiLCJ0eXBlIiwiQ09NTUFORF9UWVBFIiwidGVzdERvbmUiLCJfZ2V0Q3VycmVudERyaXZlclRhc2tDb21tYW5kIiwibmF2aWdhdGVUbyIsInN0YXRlU25hcHNob3QiLCJ1c2VTdGF0ZVNuYXBzaG90IiwiSlNPTiIsInBhcnNlIiwiX3Nob3VsZEFkZENvbW1hbmRUb1F1ZXVlIiwid2FpdCIsInNldFBhZ2VMb2FkVGltZW91dCIsImRlYnVnIiwidXNlUm9sZSIsImFzc2VydGlvbiIsIl9leGVjdXRlRXhwcmVzc2lvbiIsImV4cHJlc3Npb24iLCJyZXN1bHRWYXJpYWJsZU5hbWUiLCJpc0FzeW5jRXhwcmVzc2lvbiIsIl9leGVjdXRlQXNzZXJ0aW9uIiwiYXNzZXJ0aW9uVGltZW91dCIsIm9wdGlvbnMiLCJ0aW1lb3V0IiwiZXhlY3V0b3IiLCJBc3NlcnRpb25FeGVjdXRvciIsIm9uY2UiLCJTaG93QXNzZXJ0aW9uUmV0cmllc1N0YXR1c0NvbW1hbmQiLCJIaWRlQXNzZXJ0aW9uUmV0cmllc1N0YXR1c0NvbW1hbmQiLCJzdWNjZXNzIiwicnVuIiwiX2FkanVzdENvbmZpZ3VyYXRpb25XaXRoQ29tbWFuZCIsImhpZGVCcmVha3BvaW50Iiwic2V0TmF0aXZlRGlhbG9nSGFuZGxlciIsInN3aXRjaFRvSWZyYW1lIiwic2VsZWN0b3IiLCJzd2l0Y2hUb01haW5XaW5kb3ciLCJzZXRUZXN0U3BlZWQiLCJkdXJhdGlvbiIsIl9hZGp1c3RTY3JlZW5zaG90Q29tbWFuZCIsInByb3ZpZGVyIiwiaGFzQ3VzdG9tQWN0aW9uRm9yQnJvd3NlciIsImhhc0Nocm9tZWxlc3NTY3JlZW5zaG90cyIsImdlbmVyYXRlU2NyZWVuc2hvdE1hcmsiLCJfc2V0QnJlYWtwb2ludElmTmVjZXNzYXJ5IiwiX3JlamVjdENvbW1hbmRXaXRoUGFnZUVycm9yIiwiX3VzZVJvbGUiLCJyb2xlIiwiZXhlY3V0ZUV4cHJlc3Npb24iLCJnZXRCcm93c2VyQ29uc29sZU1lc3NhZ2VzIiwiZ2V0U3RhdGVTbmFwc2hvdCIsInN0YXRlIiwic3RvcmFnZXMiLCJCYWNrdXBTdG9yYWdlc0NvbW1hbmQiLCJzd2l0Y2hUb0NsZWFuUnVuIiwicmVtb3ZlRGlhbG9nSGFuZGxlckNvbW1hbmQiLCJTZXROYXRpdmVEaWFsb2dIYW5kbGVyQ29tbWFuZCIsInNldFNwZWVkQ29tbWFuZCIsIlNldFRlc3RTcGVlZENvbW1hbmQiLCJzZXRQYWdlTG9hZFRpbWVvdXRDb21tYW5kIiwiU2V0UGFnZUxvYWRUaW1lb3V0Q29tbWFuZCIsIl9nZXRTdGF0ZVNuYXBzaG90RnJvbVJvbGUiLCJwcmV2UGhhc2UiLCJpblJvbGVJbml0aWFsaXplciIsIlJPTEVfUEhBU0UiLCJ1bmluaXRpYWxpemVkIiwiaW5pdGlhbGl6ZSIsInBlbmRpbmdJbml0aWFsaXphdGlvbiIsImluaXRFcnIiLCJSb2xlU3dpdGNoSW5Sb2xlSW5pdGlhbGl6ZXJFcnJvciIsImJvb2ttYXJrIiwiVGVzdFJ1bkJvb2ttYXJrIiwiaW5pdCIsInJlc3RvcmUiLCJnZXRDdXJyZW50VXJsIiwiYnVpbGRlciIsIkNsaWVudEZ1bmN0aW9uQnVpbGRlciIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsImJvdW5kVGVzdFJ1biIsImdldExvY2F0aW9uIiwiZ2V0RnVuY3Rpb24iLCJTZXJ2aWNlTWVzc2FnZXMiLCJwcm90b3R5cGUiLCJDTElFTlRfTUVTU0FHRVMiLCJyZWFkeSIsIm1zZyIsImRyaXZlck1lc3NhZ2UiLCJzdGF0dXMiLCJzZXRUaW1lb3V0IiwicmVhZHlGb3JCcm93c2VyTWFuaXB1bGF0aW9uIiwiZXhlY3V0ZVBlbmRpbmdNYW5pcHVsYXRpb24iLCJ3YWl0Rm9yRmlsZURvd25sb2FkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOztBQUNBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRUE7O0FBQ0E7O0FBR0E7O0FBUUE7Ozs7QUFRQTtBQUNBLE1BQU1BLG9CQUFrQyxnQ0FBSyxzQ0FBTCxDQUF4QztBQUNBLE1BQU1DLDJCQUFrQyxnQ0FBSyx1Q0FBTCxDQUF4QztBQUNBLE1BQU1DLGtDQUFrQyx3QkFBeEM7QUFDQSxNQUFNQyxxQkFBa0MsSUFBSSxFQUFKLEdBQVMsSUFBakQ7O0FBRUEsTUFBTUMsd0NBQXdDLGlDQUE5Qzs7QUFFZSxNQUFNQyxPQUFOLFNBQXNCQyxnQkFBdEIsQ0FBbUM7QUFDOUNDLGdCQUFhQyxJQUFiLEVBQW1CQyxpQkFBbkIsRUFBc0NDLGtCQUF0QyxFQUEwREMsVUFBMUQsRUFBc0VDLElBQXRFLEVBQTRFO0FBQ3hFOztBQUVBLGFBQUtDLHNCQUFMLElBQXNCLElBQXRCOztBQUVBLGFBQUtELElBQUwsR0FBeUJB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TixRQUFMLENBQWN3TixhQUFkLENBQTRCRCxHQUE1Qjs7QUFFQSxZQUFJdEcsU0FBUyxJQUFiO0FBQ0EsWUFBSVYsUUFBUyxJQUFiOztBQUVBLFlBQUk7QUFDQVUscUJBQVMsTUFBTSxLQUFLbkgsd0JBQUwsQ0FBOEI4TiwwQkFBOUIsQ0FBeURMLEdBQXpELENBQWY7QUFDSCxTQUZELENBR0EsT0FBT25LLEdBQVAsRUFBWTtBQUNSbUQsb0JBQVFuRCxHQUFSO0FBQ0g7O0FBRUQsZUFBTyxFQUFFNkQsTUFBRixFQUFVVixLQUFWLEVBQVA7QUFDSCxLQWREOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQWdCQTRHLGdCQUFnQkUseUJBQWdCUSxtQkFBaEMsSUFBdUQsVUFBVU4sR0FBVixFQUFlO0FBQ2xFLFNBQUt2TixRQUFMLENBQWN3TixhQUFkLENBQTRCRCxHQUE1Qjs7QUFFQSxXQUFPLElBQUl0SCxnQkFBSixDQUFZQyxXQUFXO0FBQzFCLFlBQUksS0FBSzlHLHNCQUFULEVBQWlDO0FBQzdCLGlCQUFLQSxzQkFBTCxHQUE4QixLQUE5QjtBQUNBOEcsb0JBQVEsSUFBUjtBQUNILFNBSEQsTUFLSSxLQUFLN0csb0NBQUwsR0FBNEM2RyxPQUE1QztBQUNQLEtBUE0sQ0FBUDtBQVFILENBWEQiLCJmaWxlIjoidGVzdC1ydW4vaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRXZlbnRFbWl0dGVyIGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgeyBwdWxsIGFzIHJlbW92ZSB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyByZWFkU3luYyBhcyByZWFkIH0gZnJvbSAncmVhZC1maWxlLXJlbGF0aXZlJztcbmltcG9ydCBwcm9taXNpZnlFdmVudCBmcm9tICdwcm9taXNpZnktZXZlbnQnO1xuaW1wb3J0IFByb21pc2UgZnJvbSAncGlua2llJztcbmltcG9ydCBNdXN0YWNoZSBmcm9tICdtdXN0YWNoZSc7XG5pbXBvcnQgZGVidWdMb2dnZXIgZnJvbSAnLi4vbm90aWZpY2F0aW9ucy9kZWJ1Zy1sb2dnZXInO1xuaW1wb3J0IFNlc3Npb25Db250cm9sbGVyIGZyb20gJy4vc2Vzc2lvbi1jb250cm9sbGVyJztcbmltcG9ydCBUZXN0UnVuRGVidWdMb2cgZnJvbSAnLi9kZWJ1Zy1sb2cnO1xuaW1wb3J0IFRlc3RSdW5FcnJvckZvcm1hdHRhYmxlQWRhcHRlciBmcm9tICcuLi9lcnJvcnMvdGVzdC1ydW4vZm9ybWF0dGFibGUtYWRhcHRlcic7XG5pbXBvcnQgVGVzdENhZmVFcnJvckxpc3QgZnJvbSAnLi4vZXJyb3JzL2Vycm9yLWxpc3QnO1xuaW1wb3J0IHsgZXhlY3V0ZUpzRXhwcmVzc2lvbiB9IGZyb20gJy4vZXhlY3V0ZS1qcy1leHByZXNzaW9uJztcbmltcG9ydCB7IFBhZ2VMb2FkRXJyb3IsIFJvbGVTd2l0Y2hJblJvbGVJbml0aWFsaXplckVycm9yIH0gZnJvbSAnLi4vZXJyb3JzL3Rlc3QtcnVuLyc7XG5pbXBvcnQgQnJvd3Nlck1hbmlwdWxhdGlvblF1ZXVlIGZyb20gJy4vYnJvd3Nlci1tYW5pcHVsYXRpb24tcXVldWUnO1xuaW1wb3J0IFBIQVNFIGZyb20gJy4vcGhhc2UnO1xuaW1wb3J0IENMSUVOVF9NRVNTQUdFUyBmcm9tICcuL2NsaWVudC1tZXNzYWdlcyc7XG5pbXBvcnQgQ09NTUFORF9UWVBFIGZyb20gJy4vY29tbWFuZHMvdHlwZSc7XG5pbXBvcnQgQXNzZXJ0aW9uRXhlY3V0b3IgZnJvbSAnLi4vYXNzZXJ0aW9ucy9leGVjdXRvcic7XG5pbXBvcnQgZGVsYXkgZnJvbSAnLi4vdXRpbHMvZGVsYXknO1xuaW1wb3J0IHRlc3RSdW5NYXJrZXIgZnJvbSAnLi9tYXJrZXItc3ltYm9sJztcbmltcG9ydCB0ZXN0UnVuVHJhY2tlciBmcm9tICcuLi9hcGkvdGVzdC1ydW4tdHJhY2tlcic7XG5pbXBvcnQgUk9MRV9QSEFTRSBmcm9tICcuLi9yb2xlL3BoYXNlJztcbmltcG9ydCBUZXN0UnVuQm9va21hcmsgZnJvbSAnLi9ib29rbWFyayc7XG5pbXBvcnQgQ2xpZW50RnVuY3Rpb25CdWlsZGVyIGZyb20gJy4uL2NsaWVudC1mdW5jdGlvbnMvY2xpZW50LWZ1bmN0aW9uLWJ1aWxkZXInO1xuaW1wb3J0IFJlcG9ydGVyUGx1Z2luSG9zdCBmcm9tICcuLi9yZXBvcnRlci9wbHVnaW4taG9zdCc7XG5pbXBvcnQgQnJvd3NlckNvbnNvbGVNZXNzYWdlcyBmcm9tICcuL2Jyb3dzZXItY29uc29sZS1tZXNzYWdlcyc7XG5cbmltcG9ydCB7IFRha2VTY3JlZW5zaG90T25GYWlsQ29tbWFuZCB9IGZyb20gJy4vY29tbWFuZHMvYnJvd3Nlci1tYW5pcHVsYXRpb24nO1xuaW1wb3J0IHsgU2V0TmF0aXZlRGlhbG9nSGFuZGxlckNvbW1hbmQsIFNldFRlc3RTcGVlZENvbW1hbmQsIFNldFBhZ2VMb2FkVGltZW91dENvbW1hbmQgfSBmcm9tICcuL2NvbW1hbmRzL2FjdGlvbnMnO1xuXG5cbmltcG9ydCB7XG4gICAgVGVzdERvbmVDb21tYW5kLFxuICAgIFNob3dBc3NlcnRpb25SZXRyaWVzU3RhdHVzQ29tbWFuZCxcbiAgICBIaWRlQXNzZXJ0aW9uUmV0cmllc1N0YXR1c0NvbW1hbmQsXG4gICAgU2V0QnJlYWtwb2ludENvbW1hbmQsXG4gICAgQmFja3VwU3RvcmFnZXNDb21tYW5kXG59IGZyb20gJy4vY29tbWFuZHMvc2VydmljZSc7XG5cbmltcG9ydCB7XG4gICAgaXNDb21tYW5kUmVqZWN0YWJsZUJ5UGFnZUVycm9yLFxuICAgIGlzQnJvd3Nlck1hbmlwdWxhdGlvbkNvbW1hbmQsXG4gICAgaXNTY3JlZW5zaG90Q29tbWFuZCxcbiAgICBpc1NlcnZpY2VDb21tYW5kLFxuICAgIGNhblNldERlYnVnZ2VyQnJlYWtwb2ludEJlZm9yZUNvbW1hbmRcbn0gZnJvbSAnLi9jb21tYW5kcy91dGlscyc7XG5cbi8vQ29uc3RcbmNvbnN0IFRFU1RfUlVOX1RFTVBMQVRFICAgICAgICAgICAgICAgPSByZWFkKCcuLi9jbGllbnQvdGVzdC1ydW4vaW5kZXguanMubXVzdGFjaGUnKTtcbmNvbnN0IElGUkFNRV9URVNUX1JVTl9URU1QTEFURSAgICAgICAgPSByZWFkKCcuLi9jbGllbnQvdGVzdC1ydW4vaWZyYW1lLmpzLm11c3RhY2hlJyk7XG5jb25zdCBURVNUX0RPTkVfQ09ORklSTUFUSU9OX1JFU1BPTlNFID0gJ3Rlc3QtZG9uZS1jb25maXJtYXRpb24nO1xuY29uc3QgTUFYX1JFU1BPTlNFX0RFTEFZICAgICAgICAgICAgICA9IDIgKiA2MCAqIDEwMDA7XG5cbmNvbnN0IEFMTF9EUklWRVJfVEFTS1NfQURERURfVE9fUVVFVUVfRVZFTlQgPSAnYWxsLWRyaXZlci10YXNrcy1hZGRlZC10by1xdWV1ZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRlc3RSdW4gZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICAgIGNvbnN0cnVjdG9yICh0ZXN0LCBicm93c2VyQ29ubmVjdGlvbiwgc2NyZWVuc2hvdENhcHR1cmVyLCB3YXJuaW5nTG9nLCBvcHRzKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpc1t0ZXN0UnVuTWFya2VyXSA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5vcHRzICAgICAgICAgICAgICA9IG9wdHM7XG4gICAgICAgIHRoaXMudGVzdCAgICAgICAgICAgICAgPSB0ZXN0O1xuICAgICAgICB0aGlzLmJyb3dzZXJDb25uZWN0aW9uID0gYnJvd3NlckNvbm5lY3Rpb247XG5cbiAgICAgICAgdGhpcy5waGFzZSA9IFBIQVNFLmluaXRpYWw7XG5cbiAgICAgICAgdGhpcy5kcml2ZXJUYXNrUXVldWUgICAgICAgPSBbXTtcbiAgICAgICAgdGhpcy50ZXN0RG9uZUNvbW1hbmRRdWV1ZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmFjdGl2ZURpYWxvZ0hhbmRsZXIgID0gbnVsbDtcbiAgICAgICAgdGhpcy5hY3RpdmVJZnJhbWVTZWxlY3RvciA9IG51bGw7XG4gICAgICAgIHRoaXMuc3BlZWQgICAgICAgICAgICAgICAgPSB0aGlzLm9wdHMuc3BlZWQ7XG4gICAgICAgIHRoaXMucGFnZUxvYWRUaW1lb3V0ICAgICAgPSB0aGlzLm9wdHMucGFnZUxvYWRUaW1lb3V0O1xuXG4gICAgICAgIHRoaXMuZGlzYWJsZVBhZ2VSZWxvYWRzID0gdGVzdC5kaXNhYmxlUGFnZVJlbG9hZHMgfHwgb3B0cy5kaXNhYmxlUGFnZVJlbG9hZHMgJiYgdGVzdC5kaXNhYmxlUGFnZVJlbG9hZHMgIT09IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuc2Vzc2lvbiA9IFNlc3Npb25Db250cm9sbGVyLmdldFNlc3Npb24odGhpcyk7XG5cbiAgICAgICAgdGhpcy5jb25zb2xlTWVzc2FnZXMgPSBuZXcgQnJvd3NlckNvbnNvbGVNZXNzYWdlcygpO1xuXG4gICAgICAgIHRoaXMucGVuZGluZ1JlcXVlc3QgICA9IG51bGw7XG4gICAgICAgIHRoaXMucGVuZGluZ1BhZ2VFcnJvciA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5jdHggICAgICAgID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5maXh0dXJlQ3R4ID0gbnVsbDtcblxuICAgICAgICB0aGlzLmN1cnJlbnRSb2xlSWQgID0gbnVsbDtcbiAgICAgICAgdGhpcy51c2VkUm9sZVN0YXRlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cbiAgICAgICAgdGhpcy5lcnJzID0gW107XG5cbiAgICAgICAgdGhpcy5sYXN0RHJpdmVyU3RhdHVzSWQgICAgICAgPSBudWxsO1xuICAgICAgICB0aGlzLmxhc3REcml2ZXJTdGF0dXNSZXNwb25zZSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5maWxlRG93bmxvYWRpbmdIYW5kbGVkICAgICAgICAgICAgICAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXNvbHZlV2FpdEZvckZpbGVEb3dubG9hZGluZ1Byb21pc2UgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuYWRkaW5nRHJpdmVyVGFza3NDb3VudCA9IDA7XG5cbiAgICAgICAgdGhpcy5kZWJ1Z2dpbmcgICAgICAgICAgICAgICA9IHRoaXMub3B0cy5kZWJ1Z01vZGU7XG4gICAgICAgIHRoaXMuZGVidWdPbkZhaWwgICAgICAgICAgICAgPSB0aGlzLm9wdHMuZGVidWdPbkZhaWw7XG4gICAgICAgIHRoaXMuZGlzYWJsZURlYnVnQnJlYWtwb2ludHMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kZWJ1Z1JlcG9ydGVyUGx1Z2luSG9zdCA9IG5ldyBSZXBvcnRlclBsdWdpbkhvc3QoeyBub0NvbG9yczogZmFsc2UgfSk7XG5cbiAgICAgICAgdGhpcy5icm93c2VyTWFuaXB1bGF0aW9uUXVldWUgPSBuZXcgQnJvd3Nlck1hbmlwdWxhdGlvblF1ZXVlKGJyb3dzZXJDb25uZWN0aW9uLCBzY3JlZW5zaG90Q2FwdHVyZXIsIHdhcm5pbmdMb2cpO1xuXG4gICAgICAgIHRoaXMuZGVidWdMb2cgPSBuZXcgVGVzdFJ1bkRlYnVnTG9nKHRoaXMuYnJvd3NlckNvbm5lY3Rpb24udXNlckFnZW50KTtcblxuICAgICAgICB0aGlzLnF1YXJhbnRpbmUgPSBudWxsO1xuXG4gICAgICAgIHRoaXMud2FybmluZ0xvZyA9IHdhcm5pbmdMb2c7XG5cbiAgICAgICAgdGhpcy5pbmplY3RhYmxlLnNjcmlwdHMucHVzaCgnL3Rlc3RjYWZlLWNvcmUuanMnKTtcbiAgICAgICAgdGhpcy5pbmplY3RhYmxlLnNjcmlwdHMucHVzaCgnL3Rlc3RjYWZlLXVpLmpzJyk7XG4gICAgICAgIHRoaXMuaW5qZWN0YWJsZS5zY3JpcHRzLnB1c2goJy90ZXN0Y2FmZS1hdXRvbWF0aW9uLmpzJyk7XG4gICAgICAgIHRoaXMuaW5qZWN0YWJsZS5zY3JpcHRzLnB1c2goJy90ZXN0Y2FmZS1kcml2ZXIuanMnKTtcbiAgICAgICAgdGhpcy5pbmplY3RhYmxlLnN0eWxlcy5wdXNoKCcvdGVzdGNhZmUtdWktc3R5bGVzLmNzcycpO1xuXG4gICAgICAgIHRoaXMucmVxdWVzdEhvb2tzID0gQXJyYXkuZnJvbSh0aGlzLnRlc3QucmVxdWVzdEhvb2tzKTtcblxuICAgICAgICB0aGlzLl9pbml0UmVxdWVzdEhvb2tzKCk7XG4gICAgfVxuXG4gICAgZ2V0IGlkICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi5pZDtcbiAgICB9XG5cbiAgICBnZXQgaW5qZWN0YWJsZSAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb24uaW5qZWN0YWJsZTtcbiAgICB9XG5cbiAgICBhZGRRdWFyYW50aW5lSW5mbyAocXVhcmFudGluZSkge1xuICAgICAgICB0aGlzLnF1YXJhbnRpbmUgPSBxdWFyYW50aW5lO1xuICAgIH1cblxuICAgIGFkZFJlcXVlc3RIb29rIChob29rKSB7XG4gICAgICAgIGlmICh0aGlzLnJlcXVlc3RIb29rcy5pbmRleE9mKGhvb2spICE9PSAtMSlcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICB0aGlzLnJlcXVlc3RIb29rcy5wdXNoKGhvb2spO1xuICAgICAgICB0aGlzLl9pbml0UmVxdWVzdEhvb2soaG9vayk7XG4gICAgfVxuXG4gICAgcmVtb3ZlUmVxdWVzdEhvb2sgKGhvb2spIHtcbiAgICAgICAgaWYgKHRoaXMucmVxdWVzdEhvb2tzLmluZGV4T2YoaG9vaykgPT09IC0xKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHJlbW92ZSh0aGlzLnJlcXVlc3RIb29rcywgaG9vayk7XG4gICAgICAgIHRoaXMuX2Rpc3Bvc2VSZXF1ZXN0SG9vayhob29rKTtcbiAgICB9XG5cbiAgICBfaW5pdFJlcXVlc3RIb29rIChob29rKSB7XG4gICAgICAgIGhvb2sud2FybmluZ0xvZyA9IHRoaXMud2FybmluZ0xvZztcblxuICAgICAgICBob29rLl9pbnN0YW50aWF0ZVJlcXVlc3RGaWx0ZXJSdWxlcygpO1xuICAgICAgICBob29rLl9pbnN0YW50aWF0ZWRSZXF1ZXN0RmlsdGVyUnVsZXMuZm9yRWFjaChydWxlID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbi5hZGRSZXF1ZXN0RXZlbnRMaXN0ZW5lcnMocnVsZSwge1xuICAgICAgICAgICAgICAgIG9uUmVxdWVzdDogICAgICAgICAgIGhvb2sub25SZXF1ZXN0LmJpbmQoaG9vayksXG4gICAgICAgICAgICAgICAgb25Db25maWd1cmVSZXNwb25zZTogaG9vay5fb25Db25maWd1cmVSZXNwb25zZS5iaW5kKGhvb2spLFxuICAgICAgICAgICAgICAgIG9uUmVzcG9uc2U6ICAgICAgICAgIGhvb2sub25SZXNwb25zZS5iaW5kKGhvb2spXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgX2Rpc3Bvc2VSZXF1ZXN0SG9vayAoaG9vaykge1xuICAgICAgICBob29rLndhcm5pbmdMb2cgPSBudWxsO1xuXG4gICAgICAgIGhvb2suX2luc3RhbnRpYXRlZFJlcXVlc3RGaWx0ZXJSdWxlcy5mb3JFYWNoKHJ1bGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXNzaW9uLnJlbW92ZVJlcXVlc3RFdmVudExpc3RlbmVycyhydWxlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgX2luaXRSZXF1ZXN0SG9va3MgKCkge1xuICAgICAgICB0aGlzLnJlcXVlc3RIb29rcy5mb3JFYWNoKGhvb2sgPT4gdGhpcy5faW5pdFJlcXVlc3RIb29rKGhvb2spKTtcbiAgICB9XG5cblxuICAgIC8vIEhhbW1lcmhlYWQgcGF5bG9hZFxuICAgIF9nZXRQYXlsb2FkU2NyaXB0ICgpIHtcbiAgICAgICAgdGhpcy5maWxlRG93bmxvYWRpbmdIYW5kbGVkICAgICAgICAgICAgICAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXNvbHZlV2FpdEZvckZpbGVEb3dubG9hZGluZ1Byb21pc2UgPSBudWxsO1xuXG4gICAgICAgIHJldHVybiBNdXN0YWNoZS5yZW5kZXIoVEVTVF9SVU5fVEVNUExBVEUsIHtcbiAgICAgICAgICAgIHRlc3RSdW5JZDogICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMuc2Vzc2lvbi5pZCksXG4gICAgICAgICAgICBicm93c2VySWQ6ICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLmJyb3dzZXJDb25uZWN0aW9uLmlkKSxcbiAgICAgICAgICAgIGJyb3dzZXJIZWFydGJlYXRSZWxhdGl2ZVVybDogIEpTT04uc3RyaW5naWZ5KHRoaXMuYnJvd3NlckNvbm5lY3Rpb24uaGVhcnRiZWF0UmVsYXRpdmVVcmwpLFxuICAgICAgICAgICAgYnJvd3NlclN0YXR1c1JlbGF0aXZlVXJsOiAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy5icm93c2VyQ29ubmVjdGlvbi5zdGF0dXNSZWxhdGl2ZVVybCksXG4gICAgICAgICAgICBicm93c2VyU3RhdHVzRG9uZVJlbGF0aXZlVXJsOiBKU09OLnN0cmluZ2lmeSh0aGlzLmJyb3dzZXJDb25uZWN0aW9uLnN0YXR1c0RvbmVSZWxhdGl2ZVVybCksXG4gICAgICAgICAgICB1c2VyQWdlbnQ6ICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLmJyb3dzZXJDb25uZWN0aW9uLnVzZXJBZ2VudCksXG4gICAgICAgICAgICB0ZXN0TmFtZTogICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLnRlc3QubmFtZSksXG4gICAgICAgICAgICBmaXh0dXJlTmFtZTogICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLnRlc3QuZml4dHVyZS5uYW1lKSxcbiAgICAgICAgICAgIHNlbGVjdG9yVGltZW91dDogICAgICAgICAgICAgIHRoaXMub3B0cy5zZWxlY3RvclRpbWVvdXQsXG4gICAgICAgICAgICBwYWdlTG9hZFRpbWVvdXQ6ICAgICAgICAgICAgICB0aGlzLnBhZ2VMb2FkVGltZW91dCxcbiAgICAgICAgICAgIHNraXBKc0Vycm9yczogICAgICAgICAgICAgICAgIHRoaXMub3B0cy5za2lwSnNFcnJvcnMsXG4gICAgICAgICAgICBzcGVlZDogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNwZWVkLFxuICAgICAgICAgICAgZGlhbG9nSGFuZGxlcjogICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy5hY3RpdmVEaWFsb2dIYW5kbGVyKVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBfZ2V0SWZyYW1lUGF5bG9hZFNjcmlwdCAoKSB7XG4gICAgICAgIHJldHVybiBNdXN0YWNoZS5yZW5kZXIoSUZSQU1FX1RFU1RfUlVOX1RFTVBMQVRFLCB7XG4gICAgICAgICAgICB0ZXN0UnVuSWQ6ICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMuc2Vzc2lvbi5pZCksXG4gICAgICAgICAgICBzZWxlY3RvclRpbWVvdXQ6IHRoaXMub3B0cy5zZWxlY3RvclRpbWVvdXQsXG4gICAgICAgICAgICBwYWdlTG9hZFRpbWVvdXQ6IHRoaXMucGFnZUxvYWRUaW1lb3V0LFxuICAgICAgICAgICAgc3BlZWQ6ICAgICAgICAgICB0aGlzLnNwZWVkLFxuICAgICAgICAgICAgZGlhbG9nSGFuZGxlcjogICBKU09OLnN0cmluZ2lmeSh0aGlzLmFjdGl2ZURpYWxvZ0hhbmRsZXIpXG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgLy8gSGFtbWVyaGVhZCBoYW5kbGVyc1xuICAgIGdldEF1dGhDcmVkZW50aWFscyAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRlc3QuYXV0aENyZWRlbnRpYWxzO1xuICAgIH1cblxuICAgIGhhbmRsZUZpbGVEb3dubG9hZCAoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSkge1xuICAgICAgICAgICAgdGhpcy5yZXNvbHZlV2FpdEZvckZpbGVEb3dubG9hZGluZ1Byb21pc2UodHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLnJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5maWxlRG93bmxvYWRpbmdIYW5kbGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBoYW5kbGVQYWdlRXJyb3IgKGN0eCwgZXJyKSB7XG4gICAgICAgIHRoaXMucGVuZGluZ1BhZ2VFcnJvciA9IG5ldyBQYWdlTG9hZEVycm9yKGVycik7XG5cbiAgICAgICAgY3R4LnJlZGlyZWN0KGN0eC50b1Byb3h5VXJsKCdhYm91dDplcnJvcicpKTtcbiAgICB9XG5cbiAgICAvLyBUZXN0IGZ1bmN0aW9uIGV4ZWN1dGlvblxuICAgIGFzeW5jIF9leGVjdXRlVGVzdEZuIChwaGFzZSwgZm4pIHtcbiAgICAgICAgdGhpcy5waGFzZSA9IHBoYXNlO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBmbih0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB2YXIgc2NyZWVuc2hvdFBhdGggPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRzLnRha2VTY3JlZW5zaG90c09uRmFpbHMpXG4gICAgICAgICAgICAgICAgc2NyZWVuc2hvdFBhdGggPSBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKG5ldyBUYWtlU2NyZWVuc2hvdE9uRmFpbENvbW1hbmQoKSk7XG5cbiAgICAgICAgICAgIHRoaXMuYWRkRXJyb3IoZXJyLCBzY3JlZW5zaG90UGF0aCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gIXRoaXMuX2FkZFBlbmRpbmdQYWdlRXJyb3JJZkFueSgpO1xuICAgIH1cblxuICAgIGFzeW5jIF9ydW5CZWZvcmVIb29rICgpIHtcbiAgICAgICAgaWYgKHRoaXMudGVzdC5iZWZvcmVGbilcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9leGVjdXRlVGVzdEZuKFBIQVNFLmluVGVzdEJlZm9yZUhvb2ssIHRoaXMudGVzdC5iZWZvcmVGbik7XG5cbiAgICAgICAgaWYgKHRoaXMudGVzdC5maXh0dXJlLmJlZm9yZUVhY2hGbilcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9leGVjdXRlVGVzdEZuKFBIQVNFLmluRml4dHVyZUJlZm9yZUVhY2hIb29rLCB0aGlzLnRlc3QuZml4dHVyZS5iZWZvcmVFYWNoRm4pO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGFzeW5jIF9ydW5BZnRlckhvb2sgKCkge1xuICAgICAgICBpZiAodGhpcy50ZXN0LmFmdGVyRm4pXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fZXhlY3V0ZVRlc3RGbihQSEFTRS5pblRlc3RBZnRlckhvb2ssIHRoaXMudGVzdC5hZnRlckZuKTtcblxuICAgICAgICBpZiAodGhpcy50ZXN0LmZpeHR1cmUuYWZ0ZXJFYWNoRm4pXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fZXhlY3V0ZVRlc3RGbihQSEFTRS5pbkZpeHR1cmVBZnRlckVhY2hIb29rLCB0aGlzLnRlc3QuZml4dHVyZS5hZnRlckVhY2hGbik7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgYXN5bmMgc3RhcnQgKCkge1xuICAgICAgICB0ZXN0UnVuVHJhY2tlci5hY3RpdmVUZXN0UnVuc1t0aGlzLnNlc3Npb24uaWRdID0gdGhpcztcblxuICAgICAgICB0aGlzLmVtaXQoJ3N0YXJ0Jyk7XG5cbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuX3J1bkJlZm9yZUhvb2soKSkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5fZXhlY3V0ZVRlc3RGbihQSEFTRS5pblRlc3QsIHRoaXMudGVzdC5mbik7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9ydW5BZnRlckhvb2soKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmVycnMubGVuZ3RoICYmIHRoaXMuZGVidWdPbkZhaWwpXG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9lbnF1ZXVlU2V0QnJlYWtwb2ludENvbW1hbmQobnVsbCwgdGhpcy5kZWJ1Z1JlcG9ydGVyUGx1Z2luSG9zdC5mb3JtYXRFcnJvcih0aGlzLmVycnNbMF0pKTtcblxuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKG5ldyBUZXN0RG9uZUNvbW1hbmQoKSk7XG4gICAgICAgIHRoaXMuX2FkZFBlbmRpbmdQYWdlRXJyb3JJZkFueSgpO1xuXG4gICAgICAgIGRlbGV0ZSB0ZXN0UnVuVHJhY2tlci5hY3RpdmVUZXN0UnVuc1t0aGlzLnNlc3Npb24uaWRdO1xuXG4gICAgICAgIHRoaXMuZW1pdCgnZG9uZScpO1xuICAgIH1cblxuICAgIF9ldmFsdWF0ZSAoY29kZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGVKc0V4cHJlc3Npb24oY29kZSwgdGhpcywgeyBza2lwVmlzaWJpbGl0eUNoZWNrOiBmYWxzZSB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlcnIgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIEVycm9yc1xuICAgIF9hZGRQZW5kaW5nUGFnZUVycm9ySWZBbnkgKCkge1xuICAgICAgICBpZiAodGhpcy5wZW5kaW5nUGFnZUVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmFkZEVycm9yKHRoaXMucGVuZGluZ1BhZ2VFcnJvcik7XG4gICAgICAgICAgICB0aGlzLnBlbmRpbmdQYWdlRXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgYWRkRXJyb3IgKGVyciwgc2NyZWVuc2hvdFBhdGgpIHtcbiAgICAgICAgdmFyIGVyckxpc3QgPSBlcnIgaW5zdGFuY2VvZiBUZXN0Q2FmZUVycm9yTGlzdCA/IGVyci5pdGVtcyA6IFtlcnJdO1xuXG4gICAgICAgIGVyckxpc3QuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIHZhciBhZGFwdGVyID0gbmV3IFRlc3RSdW5FcnJvckZvcm1hdHRhYmxlQWRhcHRlcihpdGVtLCB7XG4gICAgICAgICAgICAgICAgdXNlckFnZW50OiAgICAgIHRoaXMuYnJvd3NlckNvbm5lY3Rpb24udXNlckFnZW50LFxuICAgICAgICAgICAgICAgIHNjcmVlbnNob3RQYXRoOiBzY3JlZW5zaG90UGF0aCB8fCAnJyxcbiAgICAgICAgICAgICAgICB0ZXN0UnVuUGhhc2U6ICAgdGhpcy5waGFzZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuZXJycy5wdXNoKGFkYXB0ZXIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBUYXNrIHF1ZXVlXG4gICAgX2VucXVldWVDb21tYW5kIChjb21tYW5kLCBjYWxsc2l0ZSkge1xuICAgICAgICBpZiAodGhpcy5wZW5kaW5nUmVxdWVzdClcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdmVQZW5kaW5nUmVxdWVzdChjb21tYW5kKTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hZGRpbmdEcml2ZXJUYXNrc0NvdW50LS07XG4gICAgICAgICAgICB0aGlzLmRyaXZlclRhc2tRdWV1ZS5wdXNoKHsgY29tbWFuZCwgcmVzb2x2ZSwgcmVqZWN0LCBjYWxsc2l0ZSB9KTtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLmFkZGluZ0RyaXZlclRhc2tzQ291bnQpXG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KEFMTF9EUklWRVJfVEFTS1NfQURERURfVE9fUVVFVUVfRVZFTlQsIHRoaXMuZHJpdmVyVGFza1F1ZXVlLmxlbmd0aCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldCBkcml2ZXJUYXNrUXVldWVMZW5ndGggKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGRpbmdEcml2ZXJUYXNrc0NvdW50ID8gcHJvbWlzaWZ5RXZlbnQodGhpcywgQUxMX0RSSVZFUl9UQVNLU19BRERFRF9UT19RVUVVRV9FVkVOVCkgOiBQcm9taXNlLnJlc29sdmUodGhpcy5kcml2ZXJUYXNrUXVldWUubGVuZ3RoKTtcbiAgICB9XG5cbiAgICBhc3luYyBfZW5xdWV1ZUJyb3dzZXJDb25zb2xlTWVzc2FnZXNDb21tYW5kIChjb21tYW5kLCBjYWxsc2l0ZSkge1xuICAgICAgICBhd2FpdCB0aGlzLl9lbnF1ZXVlQ29tbWFuZChjb21tYW5kLCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc29sZU1lc3NhZ2VzLmdldENvcHkoKTtcbiAgICB9XG5cbiAgICBhc3luYyBfZW5xdWV1ZVNldEJyZWFrcG9pbnRDb21tYW5kIChjYWxsc2l0ZSwgZXJyb3IpIHtcbiAgICAgICAgZGVidWdMb2dnZXIuc2hvd0JyZWFrcG9pbnQodGhpcy5zZXNzaW9uLmlkLCB0aGlzLmJyb3dzZXJDb25uZWN0aW9uLnVzZXJBZ2VudCwgY2FsbHNpdGUsIGVycm9yKTtcblxuICAgICAgICB0aGlzLmRlYnVnZ2luZyA9IGF3YWl0IHRoaXMuZXhlY3V0ZUNvbW1hbmQobmV3IFNldEJyZWFrcG9pbnRDb21tYW5kKCEhZXJyb3IpLCBjYWxsc2l0ZSk7XG4gICAgfVxuXG4gICAgX3JlbW92ZUFsbE5vblNlcnZpY2VUYXNrcyAoKSB7XG4gICAgICAgIHRoaXMuZHJpdmVyVGFza1F1ZXVlID0gdGhpcy5kcml2ZXJUYXNrUXVldWUuZmlsdGVyKGRyaXZlclRhc2sgPT4gaXNTZXJ2aWNlQ29tbWFuZChkcml2ZXJUYXNrLmNvbW1hbmQpKTtcblxuICAgICAgICB0aGlzLmJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZS5yZW1vdmVBbGxOb25TZXJ2aWNlTWFuaXB1bGF0aW9ucygpO1xuICAgIH1cblxuXG4gICAgLy8gQ3VycmVudCBkcml2ZXIgdGFza1xuICAgIGdldCBjdXJyZW50RHJpdmVyVGFzayAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRyaXZlclRhc2tRdWV1ZVswXTtcbiAgICB9XG5cbiAgICBfcmVzb2x2ZUN1cnJlbnREcml2ZXJUYXNrIChyZXN1bHQpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50RHJpdmVyVGFzay5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIHRoaXMuZHJpdmVyVGFza1F1ZXVlLnNoaWZ0KCk7XG5cbiAgICAgICAgaWYgKHRoaXMudGVzdERvbmVDb21tYW5kUXVldWVkKVxuICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQWxsTm9uU2VydmljZVRhc2tzKCk7XG4gICAgfVxuXG4gICAgX3JlamVjdEN1cnJlbnREcml2ZXJUYXNrIChlcnIpIHtcbiAgICAgICAgZXJyLmNhbGxzaXRlICAgICAgICAgICAgID0gZXJyLmNhbGxzaXRlIHx8IHRoaXMuZHJpdmVyVGFza1F1ZXVlWzBdLmNhbGxzaXRlO1xuICAgICAgICBlcnIuaXNSZWplY3RlZERyaXZlclRhc2sgPSB0cnVlO1xuXG4gICAgICAgIHRoaXMuY3VycmVudERyaXZlclRhc2sucmVqZWN0KGVycik7XG4gICAgICAgIHRoaXMuX3JlbW92ZUFsbE5vblNlcnZpY2VUYXNrcygpO1xuICAgIH1cblxuXG4gICAgLy8gUGVuZGluZyByZXF1ZXN0XG4gICAgX2NsZWFyUGVuZGluZ1JlcXVlc3QgKCkge1xuICAgICAgICBpZiAodGhpcy5wZW5kaW5nUmVxdWVzdCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucGVuZGluZ1JlcXVlc3QucmVzcG9uc2VUaW1lb3V0KTtcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ1JlcXVlc3QgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3Jlc29sdmVQZW5kaW5nUmVxdWVzdCAoY29tbWFuZCkge1xuICAgICAgICB0aGlzLmxhc3REcml2ZXJTdGF0dXNSZXNwb25zZSA9IGNvbW1hbmQ7XG4gICAgICAgIHRoaXMucGVuZGluZ1JlcXVlc3QucmVzb2x2ZShjb21tYW5kKTtcbiAgICAgICAgdGhpcy5fY2xlYXJQZW5kaW5nUmVxdWVzdCgpO1xuICAgIH1cblxuXG4gICAgLy8gSGFuZGxlIGRyaXZlciByZXF1ZXN0XG4gICAgX2Z1bGZpbGxDdXJyZW50RHJpdmVyVGFzayAoZHJpdmVyU3RhdHVzKSB7XG4gICAgICAgIGlmIChkcml2ZXJTdGF0dXMuZXhlY3V0aW9uRXJyb3IpXG4gICAgICAgICAgICB0aGlzLl9yZWplY3RDdXJyZW50RHJpdmVyVGFzayhkcml2ZXJTdGF0dXMuZXhlY3V0aW9uRXJyb3IpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLl9yZXNvbHZlQ3VycmVudERyaXZlclRhc2soZHJpdmVyU3RhdHVzLnJlc3VsdCk7XG4gICAgfVxuXG4gICAgX2hhbmRsZVBhZ2VFcnJvclN0YXR1cyAocGFnZUVycm9yKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnREcml2ZXJUYXNrICYmIGlzQ29tbWFuZFJlamVjdGFibGVCeVBhZ2VFcnJvcih0aGlzLmN1cnJlbnREcml2ZXJUYXNrLmNvbW1hbmQpKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWplY3RDdXJyZW50RHJpdmVyVGFzayhwYWdlRXJyb3IpO1xuICAgICAgICAgICAgdGhpcy5wZW5kaW5nUGFnZUVycm9yID0gbnVsbDtcblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBlbmRpbmdQYWdlRXJyb3IgPSB0aGlzLnBlbmRpbmdQYWdlRXJyb3IgfHwgcGFnZUVycm9yO1xuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBfaGFuZGxlRHJpdmVyUmVxdWVzdCAoZHJpdmVyU3RhdHVzKSB7XG4gICAgICAgIHZhciBwYWdlRXJyb3IgPSB0aGlzLnBlbmRpbmdQYWdlRXJyb3IgfHwgZHJpdmVyU3RhdHVzLnBhZ2VFcnJvcjtcblxuICAgICAgICB2YXIgY3VycmVudFRhc2tSZWplY3RlZEJ5RXJyb3IgPSBwYWdlRXJyb3IgJiYgdGhpcy5faGFuZGxlUGFnZUVycm9yU3RhdHVzKHBhZ2VFcnJvcik7XG5cbiAgICAgICAgdGhpcy5jb25zb2xlTWVzc2FnZXMuY29uY2F0KGRyaXZlclN0YXR1cy5jb25zb2xlTWVzc2FnZXMpO1xuXG4gICAgICAgIGlmICghY3VycmVudFRhc2tSZWplY3RlZEJ5RXJyb3IgJiYgZHJpdmVyU3RhdHVzLmlzQ29tbWFuZFJlc3VsdCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudERyaXZlclRhc2suY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUudGVzdERvbmUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXNvbHZlQ3VycmVudERyaXZlclRhc2soKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBURVNUX0RPTkVfQ09ORklSTUFUSU9OX1JFU1BPTlNFO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9mdWxmaWxsQ3VycmVudERyaXZlclRhc2soZHJpdmVyU3RhdHVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9nZXRDdXJyZW50RHJpdmVyVGFza0NvbW1hbmQoKTtcbiAgICB9XG5cbiAgICBfZ2V0Q3VycmVudERyaXZlclRhc2tDb21tYW5kICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnREcml2ZXJUYXNrKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHRoaXMuY3VycmVudERyaXZlclRhc2suY29tbWFuZDtcblxuICAgICAgICBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUubmF2aWdhdGVUbyAmJiBjb21tYW5kLnN0YXRlU25hcHNob3QpXG4gICAgICAgICAgICB0aGlzLnNlc3Npb24udXNlU3RhdGVTbmFwc2hvdChKU09OLnBhcnNlKGNvbW1hbmQuc3RhdGVTbmFwc2hvdCkpO1xuXG4gICAgICAgIHJldHVybiBjb21tYW5kO1xuICAgIH1cblxuICAgIC8vIEV4ZWN1dGUgY29tbWFuZFxuICAgIHN0YXRpYyBfc2hvdWxkQWRkQ29tbWFuZFRvUXVldWUgKGNvbW1hbmQpIHtcbiAgICAgICAgcmV0dXJuIGNvbW1hbmQudHlwZSAhPT0gQ09NTUFORF9UWVBFLndhaXQgJiYgY29tbWFuZC50eXBlICE9PSBDT01NQU5EX1RZUEUuc2V0UGFnZUxvYWRUaW1lb3V0ICYmXG4gICAgICAgICAgICAgICBjb21tYW5kLnR5cGUgIT09IENPTU1BTkRfVFlQRS5kZWJ1ZyAmJiBjb21tYW5kLnR5cGUgIT09IENPTU1BTkRfVFlQRS51c2VSb2xlICYmIGNvbW1hbmQudHlwZSAhPT0gQ09NTUFORF9UWVBFLmFzc2VydGlvbjtcbiAgICB9XG5cbiAgICBhc3luYyBfZXhlY3V0ZUV4cHJlc3Npb24gKGNvbW1hbmQpIHtcbiAgICAgICAgdmFyIHsgZXhwcmVzc2lvbiwgcmVzdWx0VmFyaWFibGVOYW1lLCBpc0FzeW5jRXhwcmVzc2lvbiB9ID0gY29tbWFuZDtcblxuICAgICAgICBpZiAoaXNBc3luY0V4cHJlc3Npb24pXG4gICAgICAgICAgICBleHByZXNzaW9uID0gYGF3YWl0ICR7ZXhwcmVzc2lvbn1gO1xuXG4gICAgICAgIGlmIChyZXN1bHRWYXJpYWJsZU5hbWUpXG4gICAgICAgICAgICBleHByZXNzaW9uID0gYCR7cmVzdWx0VmFyaWFibGVOYW1lfSA9ICR7ZXhwcmVzc2lvbn0sICR7cmVzdWx0VmFyaWFibGVOYW1lfWA7XG5cbiAgICAgICAgaWYgKGlzQXN5bmNFeHByZXNzaW9uKVxuICAgICAgICAgICAgZXhwcmVzc2lvbiA9IGAoYXN5bmMgKCkgPT4geyByZXR1cm4gJHtleHByZXNzaW9ufTsgfSkuYXBwbHkodGhpcyk7YDtcblxuICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5fZXZhbHVhdGUoZXhwcmVzc2lvbik7XG5cbiAgICAgICAgcmV0dXJuIGlzQXN5bmNFeHByZXNzaW9uID8gYXdhaXQgcmVzdWx0IDogcmVzdWx0O1xuICAgIH1cblxuICAgIGFzeW5jIF9leGVjdXRlQXNzZXJ0aW9uIChjb21tYW5kLCBjYWxsc2l0ZSkge1xuICAgICAgICB2YXIgYXNzZXJ0aW9uVGltZW91dCA9IGNvbW1hbmQub3B0aW9ucy50aW1lb3V0ID09PSB2b2lkIDAgPyB0aGlzLm9wdHMuYXNzZXJ0aW9uVGltZW91dCA6IGNvbW1hbmQub3B0aW9ucy50aW1lb3V0O1xuICAgICAgICB2YXIgZXhlY3V0b3IgICAgICAgICA9IG5ldyBBc3NlcnRpb25FeGVjdXRvcihjb21tYW5kLCBhc3NlcnRpb25UaW1lb3V0LCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgZXhlY3V0b3Iub25jZSgnc3RhcnQtYXNzZXJ0aW9uLXJldHJpZXMnLCB0aW1lb3V0ID0+IHRoaXMuZXhlY3V0ZUNvbW1hbmQobmV3IFNob3dBc3NlcnRpb25SZXRyaWVzU3RhdHVzQ29tbWFuZCh0aW1lb3V0KSkpO1xuICAgICAgICBleGVjdXRvci5vbmNlKCdlbmQtYXNzZXJ0aW9uLXJldHJpZXMnLCBzdWNjZXNzID0+IHRoaXMuZXhlY3V0ZUNvbW1hbmQobmV3IEhpZGVBc3NlcnRpb25SZXRyaWVzU3RhdHVzQ29tbWFuZChzdWNjZXNzKSkpO1xuXG4gICAgICAgIHJldHVybiBleGVjdXRvci5ydW4oKTtcbiAgICB9XG5cbiAgICBfYWRqdXN0Q29uZmlndXJhdGlvbldpdGhDb21tYW5kIChjb21tYW5kKSB7XG4gICAgICAgIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS50ZXN0RG9uZSkge1xuICAgICAgICAgICAgdGhpcy50ZXN0RG9uZUNvbW1hbmRRdWV1ZWQgPSB0cnVlO1xuICAgICAgICAgICAgZGVidWdMb2dnZXIuaGlkZUJyZWFrcG9pbnQodGhpcy5zZXNzaW9uLmlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLnNldE5hdGl2ZURpYWxvZ0hhbmRsZXIpXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZURpYWxvZ0hhbmRsZXIgPSBjb21tYW5kLmRpYWxvZ0hhbmRsZXI7XG5cbiAgICAgICAgZWxzZSBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuc3dpdGNoVG9JZnJhbWUpXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUlmcmFtZVNlbGVjdG9yID0gY29tbWFuZC5zZWxlY3RvcjtcblxuICAgICAgICBlbHNlIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5zd2l0Y2hUb01haW5XaW5kb3cpXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUlmcmFtZVNlbGVjdG9yID0gbnVsbDtcblxuICAgICAgICBlbHNlIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5zZXRUZXN0U3BlZWQpXG4gICAgICAgICAgICB0aGlzLnNwZWVkID0gY29tbWFuZC5zcGVlZDtcblxuICAgICAgICBlbHNlIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5zZXRQYWdlTG9hZFRpbWVvdXQpXG4gICAgICAgICAgICB0aGlzLnBhZ2VMb2FkVGltZW91dCA9IGNvbW1hbmQuZHVyYXRpb247XG5cbiAgICAgICAgZWxzZSBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuZGVidWcpXG4gICAgICAgICAgICB0aGlzLmRlYnVnZ2luZyA9IHRydWU7XG4gICAgfVxuXG4gICAgYXN5bmMgX2FkanVzdFNjcmVlbnNob3RDb21tYW5kIChjb21tYW5kKSB7XG4gICAgICAgIGNvbnN0IGJyb3dzZXJJZCAgICAgICAgICAgICAgICAgICAgPSB0aGlzLmJyb3dzZXJDb25uZWN0aW9uLmlkO1xuICAgICAgICBjb25zdCB7IGhhc0Nocm9tZWxlc3NTY3JlZW5zaG90cyB9ID0gYXdhaXQgdGhpcy5icm93c2VyQ29ubmVjdGlvbi5wcm92aWRlci5oYXNDdXN0b21BY3Rpb25Gb3JCcm93c2VyKGJyb3dzZXJJZCk7XG5cbiAgICAgICAgaWYgKCFoYXNDaHJvbWVsZXNzU2NyZWVuc2hvdHMpXG4gICAgICAgICAgICBjb21tYW5kLmdlbmVyYXRlU2NyZWVuc2hvdE1hcmsoKTtcbiAgICB9XG5cbiAgICBhc3luYyBfc2V0QnJlYWtwb2ludElmTmVjZXNzYXJ5IChjb21tYW5kLCBjYWxsc2l0ZSkge1xuICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZURlYnVnQnJlYWtwb2ludHMgJiYgdGhpcy5kZWJ1Z2dpbmcgJiYgY2FuU2V0RGVidWdnZXJCcmVha3BvaW50QmVmb3JlQ29tbWFuZChjb21tYW5kKSlcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2VucXVldWVTZXRCcmVha3BvaW50Q29tbWFuZChjYWxsc2l0ZSk7XG4gICAgfVxuXG4gICAgYXN5bmMgZXhlY3V0ZUNvbW1hbmQgKGNvbW1hbmQsIGNhbGxzaXRlKSB7XG4gICAgICAgIHRoaXMuZGVidWdMb2cuY29tbWFuZChjb21tYW5kKTtcblxuICAgICAgICBpZiAodGhpcy5wZW5kaW5nUGFnZUVycm9yICYmIGlzQ29tbWFuZFJlamVjdGFibGVCeVBhZ2VFcnJvcihjb21tYW5kKSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWplY3RDb21tYW5kV2l0aFBhZ2VFcnJvcihjYWxsc2l0ZSk7XG5cbiAgICAgICAgaWYgKFRlc3RSdW4uX3Nob3VsZEFkZENvbW1hbmRUb1F1ZXVlKGNvbW1hbmQpKVxuICAgICAgICAgICAgdGhpcy5hZGRpbmdEcml2ZXJUYXNrc0NvdW50Kys7XG5cbiAgICAgICAgdGhpcy5fYWRqdXN0Q29uZmlndXJhdGlvbldpdGhDb21tYW5kKGNvbW1hbmQpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMuX3NldEJyZWFrcG9pbnRJZk5lY2Vzc2FyeShjb21tYW5kLCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgaWYgKGlzU2NyZWVuc2hvdENvbW1hbmQoY29tbWFuZCkpXG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9hZGp1c3RTY3JlZW5zaG90Q29tbWFuZChjb21tYW5kKTtcblxuICAgICAgICBpZiAoaXNCcm93c2VyTWFuaXB1bGF0aW9uQ29tbWFuZChjb21tYW5kKSlcbiAgICAgICAgICAgIHRoaXMuYnJvd3Nlck1hbmlwdWxhdGlvblF1ZXVlLnB1c2goY29tbWFuZCk7XG5cbiAgICAgICAgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLndhaXQpXG4gICAgICAgICAgICByZXR1cm4gZGVsYXkoY29tbWFuZC50aW1lb3V0KTtcblxuICAgICAgICBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuc2V0UGFnZUxvYWRUaW1lb3V0KVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLmRlYnVnKVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2VucXVldWVTZXRCcmVha3BvaW50Q29tbWFuZChjYWxsc2l0ZSk7XG5cbiAgICAgICAgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLnVzZVJvbGUpXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fdXNlUm9sZShjb21tYW5kLnJvbGUsIGNhbGxzaXRlKTtcblxuICAgICAgICBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuYXNzZXJ0aW9uKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4ZWN1dGVBc3NlcnRpb24oY29tbWFuZCwgY2FsbHNpdGUpO1xuXG4gICAgICAgIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5leGVjdXRlRXhwcmVzc2lvbilcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9leGVjdXRlRXhwcmVzc2lvbihjb21tYW5kLCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLmdldEJyb3dzZXJDb25zb2xlTWVzc2FnZXMpXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fZW5xdWV1ZUJyb3dzZXJDb25zb2xlTWVzc2FnZXNDb21tYW5kKGNvbW1hbmQsIGNhbGxzaXRlKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoY29tbWFuZCwgY2FsbHNpdGUpO1xuICAgIH1cblxuICAgIF9yZWplY3RDb21tYW5kV2l0aFBhZ2VFcnJvciAoY2FsbHNpdGUpIHtcbiAgICAgICAgdmFyIGVyciA9IHRoaXMucGVuZGluZ1BhZ2VFcnJvcjtcblxuICAgICAgICBlcnIuY2FsbHNpdGUgICAgICAgICAgPSBjYWxsc2l0ZTtcbiAgICAgICAgdGhpcy5wZW5kaW5nUGFnZUVycm9yID0gbnVsbDtcblxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICB9XG5cbiAgICAvLyBSb2xlIG1hbmFnZW1lbnRcbiAgICBhc3luYyBnZXRTdGF0ZVNuYXBzaG90ICgpIHtcbiAgICAgICAgdmFyIHN0YXRlID0gdGhpcy5zZXNzaW9uLmdldFN0YXRlU25hcHNob3QoKTtcblxuICAgICAgICBzdGF0ZS5zdG9yYWdlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZUNvbW1hbmQobmV3IEJhY2t1cFN0b3JhZ2VzQ29tbWFuZCgpKTtcblxuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxuXG4gICAgYXN5bmMgc3dpdGNoVG9DbGVhblJ1biAoKSB7XG4gICAgICAgIHRoaXMuY3R4ICAgICAgICAgICAgID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5maXh0dXJlQ3R4ICAgICAgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgICAgICB0aGlzLmNvbnNvbGVNZXNzYWdlcyA9IG5ldyBCcm93c2VyQ29uc29sZU1lc3NhZ2VzKCk7XG5cbiAgICAgICAgdGhpcy5zZXNzaW9uLnVzZVN0YXRlU25hcHNob3QobnVsbCk7XG5cbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlRGlhbG9nSGFuZGxlcikge1xuICAgICAgICAgICAgdmFyIHJlbW92ZURpYWxvZ0hhbmRsZXJDb21tYW5kID0gbmV3IFNldE5hdGl2ZURpYWxvZ0hhbmRsZXJDb21tYW5kKHsgZGlhbG9nSGFuZGxlcjogeyBmbjogbnVsbCB9IH0pO1xuXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKHJlbW92ZURpYWxvZ0hhbmRsZXJDb21tYW5kKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNwZWVkICE9PSB0aGlzLm9wdHMuc3BlZWQpIHtcbiAgICAgICAgICAgIHZhciBzZXRTcGVlZENvbW1hbmQgPSBuZXcgU2V0VGVzdFNwZWVkQ29tbWFuZCh7IHNwZWVkOiB0aGlzLm9wdHMuc3BlZWQgfSk7XG5cbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUNvbW1hbmQoc2V0U3BlZWRDb21tYW5kKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnBhZ2VMb2FkVGltZW91dCAhPT0gdGhpcy5vcHRzLnBhZ2VMb2FkVGltZW91dCkge1xuICAgICAgICAgICAgdmFyIHNldFBhZ2VMb2FkVGltZW91dENvbW1hbmQgPSBuZXcgU2V0UGFnZUxvYWRUaW1lb3V0Q29tbWFuZCh7IGR1cmF0aW9uOiB0aGlzLm9wdHMucGFnZUxvYWRUaW1lb3V0IH0pO1xuXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKHNldFBhZ2VMb2FkVGltZW91dENvbW1hbmQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgX2dldFN0YXRlU25hcHNob3RGcm9tUm9sZSAocm9sZSkge1xuICAgICAgICB2YXIgcHJldlBoYXNlID0gdGhpcy5waGFzZTtcblxuICAgICAgICB0aGlzLnBoYXNlID0gUEhBU0UuaW5Sb2xlSW5pdGlhbGl6ZXI7XG5cbiAgICAgICAgaWYgKHJvbGUucGhhc2UgPT09IFJPTEVfUEhBU0UudW5pbml0aWFsaXplZClcbiAgICAgICAgICAgIGF3YWl0IHJvbGUuaW5pdGlhbGl6ZSh0aGlzKTtcblxuICAgICAgICBlbHNlIGlmIChyb2xlLnBoYXNlID09PSBST0xFX1BIQVNFLnBlbmRpbmdJbml0aWFsaXphdGlvbilcbiAgICAgICAgICAgIGF3YWl0IHByb21pc2lmeUV2ZW50KHJvbGUsICdpbml0aWFsaXplZCcpO1xuXG4gICAgICAgIGlmIChyb2xlLmluaXRFcnIpXG4gICAgICAgICAgICB0aHJvdyByb2xlLmluaXRFcnI7XG5cbiAgICAgICAgdGhpcy5waGFzZSA9IHByZXZQaGFzZTtcblxuICAgICAgICByZXR1cm4gcm9sZS5zdGF0ZVNuYXBzaG90O1xuICAgIH1cblxuICAgIGFzeW5jIF91c2VSb2xlIChyb2xlLCBjYWxsc2l0ZSkge1xuICAgICAgICBpZiAodGhpcy5waGFzZSA9PT0gUEhBU0UuaW5Sb2xlSW5pdGlhbGl6ZXIpXG4gICAgICAgICAgICB0aHJvdyBuZXcgUm9sZVN3aXRjaEluUm9sZUluaXRpYWxpemVyRXJyb3IoY2FsbHNpdGUpO1xuXG4gICAgICAgIHRoaXMuZGlzYWJsZURlYnVnQnJlYWtwb2ludHMgPSB0cnVlO1xuXG4gICAgICAgIHZhciBib29rbWFyayA9IG5ldyBUZXN0UnVuQm9va21hcmsodGhpcywgcm9sZSk7XG5cbiAgICAgICAgYXdhaXQgYm9va21hcmsuaW5pdCgpO1xuXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRSb2xlSWQpXG4gICAgICAgICAgICB0aGlzLnVzZWRSb2xlU3RhdGVzW3RoaXMuY3VycmVudFJvbGVJZF0gPSBhd2FpdCB0aGlzLmdldFN0YXRlU25hcHNob3QoKTtcblxuICAgICAgICB2YXIgc3RhdGVTbmFwc2hvdCA9IHRoaXMudXNlZFJvbGVTdGF0ZXNbcm9sZS5pZF0gfHwgYXdhaXQgdGhpcy5fZ2V0U3RhdGVTbmFwc2hvdEZyb21Sb2xlKHJvbGUpO1xuXG4gICAgICAgIHRoaXMuc2Vzc2lvbi51c2VTdGF0ZVNuYXBzaG90KHN0YXRlU25hcHNob3QpO1xuXG4gICAgICAgIHRoaXMuY3VycmVudFJvbGVJZCA9IHJvbGUuaWQ7XG5cbiAgICAgICAgYXdhaXQgYm9va21hcmsucmVzdG9yZShjYWxsc2l0ZSwgc3RhdGVTbmFwc2hvdCk7XG5cbiAgICAgICAgdGhpcy5kaXNhYmxlRGVidWdCcmVha3BvaW50cyA9IGZhbHNlO1xuICAgIH1cblxuXG4gICAgLy8gR2V0IGN1cnJlbnQgVVJMXG4gICAgYXN5bmMgZ2V0Q3VycmVudFVybCAoKSB7XG4gICAgICAgIHZhciBidWlsZGVyID0gbmV3IENsaWVudEZ1bmN0aW9uQnVpbGRlcigoKSA9PiB7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiAqL1xuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby11bmRlZiAqL1xuICAgICAgICB9LCB7IGJvdW5kVGVzdFJ1bjogdGhpcyB9KTtcblxuICAgICAgICB2YXIgZ2V0TG9jYXRpb24gPSBidWlsZGVyLmdldEZ1bmN0aW9uKCk7XG5cbiAgICAgICAgcmV0dXJuIGF3YWl0IGdldExvY2F0aW9uKCk7XG4gICAgfVxufVxuXG5cbi8vIFNlcnZpY2UgbWVzc2FnZSBoYW5kbGVyc1xudmFyIFNlcnZpY2VNZXNzYWdlcyA9IFRlc3RSdW4ucHJvdG90eXBlO1xuXG5TZXJ2aWNlTWVzc2FnZXNbQ0xJRU5UX01FU1NBR0VTLnJlYWR5XSA9IGZ1bmN0aW9uIChtc2cpIHtcbiAgICB0aGlzLmRlYnVnTG9nLmRyaXZlck1lc3NhZ2UobXNnKTtcblxuICAgIHRoaXMuX2NsZWFyUGVuZGluZ1JlcXVlc3QoKTtcblxuICAgIC8vIE5PVEU6IHRoZSBkcml2ZXIgc2VuZHMgdGhlIHN0YXR1cyBmb3IgdGhlIHNlY29uZCB0aW1lIGlmIGl0IGRpZG4ndCBnZXQgYSByZXNwb25zZSBhdCB0aGVcbiAgICAvLyBmaXJzdCB0cnkuIFRoaXMgaXMgcG9zc2libGUgd2hlbiB0aGUgcGFnZSB3YXMgdW5sb2FkZWQgYWZ0ZXIgdGhlIGRyaXZlciBzZW50IHRoZSBzdGF0dXMuXG4gICAgaWYgKG1zZy5zdGF0dXMuaWQgPT09IHRoaXMubGFzdERyaXZlclN0YXR1c0lkKVxuICAgICAgICByZXR1cm4gdGhpcy5sYXN0RHJpdmVyU3RhdHVzUmVzcG9uc2U7XG5cbiAgICB0aGlzLmxhc3REcml2ZXJTdGF0dXNJZCAgICAgICA9IG1zZy5zdGF0dXMuaWQ7XG4gICAgdGhpcy5sYXN0RHJpdmVyU3RhdHVzUmVzcG9uc2UgPSB0aGlzLl9oYW5kbGVEcml2ZXJSZXF1ZXN0KG1zZy5zdGF0dXMpO1xuXG4gICAgaWYgKHRoaXMubGFzdERyaXZlclN0YXR1c1Jlc3BvbnNlKVxuICAgICAgICByZXR1cm4gdGhpcy5sYXN0RHJpdmVyU3RhdHVzUmVzcG9uc2U7XG5cbiAgICAvLyBOT1RFOiBicm93c2VycyBhYm9ydCBhbiBvcGVuZWQgeGhyIHJlcXVlc3QgYWZ0ZXIgYSBjZXJ0YWluIHRpbWVvdXQgKHRoZSBhY3R1YWwgZHVyYXRpb24gZGVwZW5kcyBvbiB0aGUgYnJvd3NlcikuXG4gICAgLy8gVG8gYXZvaWQgdGhpcywgd2Ugc2VuZCBhbiBlbXB0eSByZXNwb25zZSBhZnRlciAyIG1pbnV0ZXMgaWYgd2UgZGlkbid0IGdldCBhbnkgY29tbWFuZC5cbiAgICB2YXIgcmVzcG9uc2VUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB0aGlzLl9yZXNvbHZlUGVuZGluZ1JlcXVlc3QobnVsbCksIE1BWF9SRVNQT05TRV9ERUxBWSk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICB0aGlzLnBlbmRpbmdSZXF1ZXN0ID0geyByZXNvbHZlLCByZWplY3QsIHJlc3BvbnNlVGltZW91dCB9O1xuICAgIH0pO1xufTtcblxuU2VydmljZU1lc3NhZ2VzW0NMSUVOVF9NRVNTQUdFUy5yZWFkeUZvckJyb3dzZXJNYW5pcHVsYXRpb25dID0gYXN5bmMgZnVuY3Rpb24gKG1zZykge1xuICAgIHRoaXMuZGVidWdMb2cuZHJpdmVyTWVzc2FnZShtc2cpO1xuXG4gICAgdmFyIHJlc3VsdCA9IG51bGw7XG4gICAgdmFyIGVycm9yICA9IG51bGw7XG5cbiAgICB0cnkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLmJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZS5leGVjdXRlUGVuZGluZ01hbmlwdWxhdGlvbihtc2cpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGVycm9yID0gZXJyO1xuICAgIH1cblxuICAgIHJldHVybiB7IHJlc3VsdCwgZXJyb3IgfTtcbn07XG5cblNlcnZpY2VNZXNzYWdlc1tDTElFTlRfTUVTU0FHRVMud2FpdEZvckZpbGVEb3dubG9hZF0gPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgdGhpcy5kZWJ1Z0xvZy5kcml2ZXJNZXNzYWdlKG1zZyk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmZpbGVEb3dubG9hZGluZ0hhbmRsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsZURvd25sb2FkaW5nSGFuZGxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLnJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSA9IHJlc29sdmU7XG4gICAgfSk7XG59O1xuIl19
