'use strict';

exports.__esModule = true;
exports.default = createStackFilter;

var _path = require('path');

var _lodash = require('lodash');

const BABEL = require.resolve('babel-core');
const BABEL_MODULES_DIR = BABEL.replace(new RegExp(`^(.*${(0, _lodash.escapeRegExp)(_path.sep)}node_modules${(0, _lodash.escapeRegExp)(_path.sep)})(.*)`), '$1');

const BABEL_RELATED = BABEL_MODULES_DIR + 'babel-';
const BABYLON = BABEL_MODULES_DIR + 'babylon' + _path.sep;
const CORE_JS = BABEL_MODULES_DIR + 'core-js' + _path.sep;
const REGENERATOR_RUNTIME = BABEL_MODULES_DIR + 'regenerator-runtime' + _path.sep;

const TESTCAFE_LIB = (0, _path.join)(__dirname, '../');
const TESTCAFE_BIN = (0, _path.join)(__dirname, '../../bin');
const TESTCAFE_HAMMERHEAD = `${_path.sep}testcafe-hammerhead${_path.sep}`;

const SOURCE_MAP_SUPPORT = `${_path.sep}source-map-support${_path.sep}`;

const INTERNAL = 'internal/';

function createStackFilter(limit) {
    var passedFramesCount = 0;

    return function stackFilter(frame) {
        if (passedFramesCount >= limit) return false;

        var filename = frame.getFileName();

        // NOTE: filter out the internals of node, Babel and TestCafe
        var pass = filename && filename.indexOf(_path.sep) > -1 && filename.indexOf(INTERNAL) !== 0 && filename.indexOf(TESTCAFE_LIB) !== 0 && filename.indexOf(TESTCAFE_BIN) !== 0 && filename.indexOf(TESTCAFE_HAMMERHEAD) < 0 && filename.indexOf(BABEL_RELATED) !== 0 && filename.indexOf(BABYLON) !== 0 && filename.indexOf(CORE_JS) !== 0 && filename.indexOf(REGENERATOR_RUNTIME) !== 0 && filename.indexOf(SOURCE_MAP_SUPPORT) < 0;

        if (pass) passedFramesCount++;

        return pass;
    };
}
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lcnJvcnMvY3JlYXRlLXN0YWNrLWZpbHRlci5qcyJdLCJuYW1lcyI6WyJjcmVhdGVTdGFja0ZpbHRlciIsIkJBQkVMIiwicmVxdWlyZSIsInJlc29sdmUiLCJCQUJFTF9NT0RVTEVTX0RJUiIsInJlcGxhY2UiLCJSZWdFeHAiLCJzZXAiLCJCQUJFTF9SRUxBVEVEIiwiQkFCWUxPTiIsIkNPUkVfSlMiLCJSRUdFTkVSQVRPUl9SVU5USU1FIiwiVEVTVENBRkVfTElCIiwiX19kaXJuYW1lIiwiVEVTVENBRkVfQklOIiwiVEVTVENBRkVfSEFNTUVSSEVBRCIsIlNPVVJDRV9NQVBfU1VQUE9SVCIsIklOVEVSTkFMIiwibGltaXQiLCJwYXNzZWRGcmFtZXNDb3VudCIsInN0YWNrRmlsdGVyIiwiZnJhbWUiLCJmaWxlbmFtZSIsImdldEZpbGVOYW1lIiwicGFzcyIsImluZGV4T2YiXSwibWFwcGluZ3MiOiI7OztrQkFtQndCQSxpQjs7QUFuQnhCOztBQUNBOztBQUVBLE1BQU1DLFFBQW9CQyxRQUFRQyxPQUFSLENBQWdCLFlBQWhCLENBQTFCO0FBQ0EsTUFBTUMsb0JBQW9CSCxNQUFNSSxPQUFOLENBQWMsSUFBSUMsTUFBSixDQUFZLE9BQU0sMEJBQVNDLFNBQVQsQ0FBYyxlQUFjLDBCQUFTQSxTQUFULENBQWMsT0FBNUQsQ0FBZCxFQUFtRixJQUFuRixDQUExQjs7QUFFQSxNQUFNQyxnQkFBc0JKLG9CQUFvQixRQUFoRDtBQUNBLE1BQU1LLFVBQXNCTCxvQkFBb0IsU0FBcEIsR0FBZ0NHLFNBQTVEO0FBQ0EsTUFBTUcsVUFBc0JOLG9CQUFvQixTQUFwQixHQUFnQ0csU0FBNUQ7QUFDQSxNQUFNSSxzQkFBc0JQLG9CQUFvQixxQkFBcEIsR0FBNENHLFNBQXhFOztBQUVBLE1BQU1LLGVBQXNCLGdCQUFLQyxTQUFMLEVBQWdCLEtBQWhCLENBQTVCO0FBQ0EsTUFBTUMsZUFBc0IsZ0JBQUtELFNBQUwsRUFBZ0IsV0FBaEIsQ0FBNUI7QUFDQSxNQUFNRSxzQkFBdUIsR0FBRVIsU0FBSSxzQkFBcUJBLFNBQUksRUFBNUQ7O0FBRUEsTUFBTVMscUJBQXNCLEdBQUVULFNBQUkscUJBQW9CQSxTQUFJLEVBQTFEOztBQUVBLE1BQU1VLFdBQVcsV0FBakI7O0FBRWUsU0FBU2pCLGlCQUFULENBQTRCa0IsS0FBNUIsRUFBbUM7QUFDOUMsUUFBSUMsb0JBQW9CLENBQXhCOztBQUVBLFdBQU8sU0FBU0MsV0FBVCxDQUFzQkMsS0FBdEIsRUFBNkI7QUFDaEMsWUFBSUYscUJBQXFCRCxLQUF6QixFQUNJLE9BQU8sS0FBUDs7QUFFSixZQUFJSSxXQUFXRCxNQUFNRSxXQUFOLEVBQWY7O0FBRUE7QUFDQSxZQUFJQyxPQUFPRixZQUNBQSxTQUFTRyxPQUFULENBQWlCbEIsU0FBakIsSUFBd0IsQ0FBQyxDQUR6QixJQUVBZSxTQUFTRyxPQUFULENBQWlCUixRQUFqQixNQUErQixDQUYvQixJQUdBSyxTQUFTRyxPQUFULENBQWlCYixZQUFqQixNQUFtQyxDQUhuQyxJQUlBVSxTQUFTRyxPQUFULENBQWlCWCxZQUFqQixNQUFtQyxDQUpuQyxJQUtBUSxTQUFTRyxPQUFULENBQWlCVixtQkFBakIsSUFBd0MsQ0FMeEMsSUFNQU8sU0FBU0csT0FBVCxDQUFpQmpCLGFBQWpCLE1BQW9DLENBTnBDLElBT0FjLFNBQVNHLE9BQVQsQ0FBaUJoQixPQUFqQixNQUE4QixDQVA5QixJQVFBYSxTQUFTRyxPQUFULENBQWlCZixPQUFqQixNQUE4QixDQVI5QixJQVNBWSxTQUFTRyxPQUFULENBQWlCZCxtQkFBakIsTUFBMEMsQ0FUMUMsSUFVQVcsU0FBU0csT0FBVCxDQUFpQlQsa0JBQWpCLElBQXVDLENBVmxEOztBQVlBLFlBQUlRLElBQUosRUFDSUw7O0FBRUosZUFBT0ssSUFBUDtBQUNILEtBdkJEO0FBd0JIIiwiZmlsZSI6ImVycm9ycy9jcmVhdGUtc3RhY2stZmlsdGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VwLCBqb2luIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBlc2NhcGVSZWdFeHAgYXMgZXNjYXBlUmUgfSBmcm9tICdsb2Rhc2gnO1xuXG5jb25zdCBCQUJFTCAgICAgICAgICAgICA9IHJlcXVpcmUucmVzb2x2ZSgnYmFiZWwtY29yZScpO1xuY29uc3QgQkFCRUxfTU9EVUxFU19ESVIgPSBCQUJFTC5yZXBsYWNlKG5ldyBSZWdFeHAoYF4oLioke2VzY2FwZVJlKHNlcCl9bm9kZV9tb2R1bGVzJHtlc2NhcGVSZShzZXApfSkoLiopYCksICckMScpO1xuXG5jb25zdCBCQUJFTF9SRUxBVEVEICAgICAgID0gQkFCRUxfTU9EVUxFU19ESVIgKyAnYmFiZWwtJztcbmNvbnN0IEJBQllMT04gICAgICAgICAgICAgPSBCQUJFTF9NT0RVTEVTX0RJUiArICdiYWJ5bG9uJyArIHNlcDtcbmNvbnN0IENPUkVfSlMgICAgICAgICAgICAgPSBCQUJFTF9NT0RVTEVTX0RJUiArICdjb3JlLWpzJyArIHNlcDtcbmNvbnN0IFJFR0VORVJBVE9SX1JVTlRJTUUgPSBCQUJFTF9NT0RVTEVTX0RJUiArICdyZWdlbmVyYXRvci1ydW50aW1lJyArIHNlcDtcblxuY29uc3QgVEVTVENBRkVfTElCICAgICAgICA9IGpvaW4oX19kaXJuYW1lLCAnLi4vJyk7XG5jb25zdCBURVNUQ0FGRV9CSU4gICAgICAgID0gam9pbihfX2Rpcm5hbWUsICcuLi8uLi9iaW4nKTtcbmNvbnN0IFRFU1RDQUZFX0hBTU1FUkhFQUQgPSBgJHtzZXB9dGVzdGNhZmUtaGFtbWVyaGVhZCR7c2VwfWA7XG5cbmNvbnN0IFNPVVJDRV9NQVBfU1VQUE9SVCA9IGAke3NlcH1zb3VyY2UtbWFwLXN1cHBvcnQke3NlcH1gO1xuXG5jb25zdCBJTlRFUk5BTCA9ICdpbnRlcm5hbC8nO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVTdGFja0ZpbHRlciAobGltaXQpIHtcbiAgICB2YXIgcGFzc2VkRnJhbWVzQ291bnQgPSAwO1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uIHN0YWNrRmlsdGVyIChmcmFtZSkge1xuICAgICAgICBpZiAocGFzc2VkRnJhbWVzQ291bnQgPj0gbGltaXQpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgdmFyIGZpbGVuYW1lID0gZnJhbWUuZ2V0RmlsZU5hbWUoKTtcblxuICAgICAgICAvLyBOT1RFOiBmaWx0ZXIgb3V0IHRoZSBpbnRlcm5hbHMgb2Ygbm9kZSwgQmFiZWwgYW5kIFRlc3RDYWZlXG4gICAgICAgIHZhciBwYXNzID0gZmlsZW5hbWUgJiZcbiAgICAgICAgICAgICAgICAgICBmaWxlbmFtZS5pbmRleE9mKHNlcCkgPiAtMSAmJlxuICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lLmluZGV4T2YoSU5URVJOQUwpICE9PSAwICYmXG4gICAgICAgICAgICAgICAgICAgZmlsZW5hbWUuaW5kZXhPZihURVNUQ0FGRV9MSUIpICE9PSAwICYmXG4gICAgICAgICAgICAgICAgICAgZmlsZW5hbWUuaW5kZXhPZihURVNUQ0FGRV9CSU4pICE9PSAwICYmXG4gICAgICAgICAgICAgICAgICAgZmlsZW5hbWUuaW5kZXhPZihURVNUQ0FGRV9IQU1NRVJIRUFEKSA8IDAgJiZcbiAgICAgICAgICAgICAgICAgICBmaWxlbmFtZS5pbmRleE9mKEJBQkVMX1JFTEFURUQpICE9PSAwICYmXG4gICAgICAgICAgICAgICAgICAgZmlsZW5hbWUuaW5kZXhPZihCQUJZTE9OKSAhPT0gMCAmJlxuICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lLmluZGV4T2YoQ09SRV9KUykgIT09IDAgJiZcbiAgICAgICAgICAgICAgICAgICBmaWxlbmFtZS5pbmRleE9mKFJFR0VORVJBVE9SX1JVTlRJTUUpICE9PSAwICYmXG4gICAgICAgICAgICAgICAgICAgZmlsZW5hbWUuaW5kZXhPZihTT1VSQ0VfTUFQX1NVUFBPUlQpIDwgMDtcblxuICAgICAgICBpZiAocGFzcylcbiAgICAgICAgICAgIHBhc3NlZEZyYW1lc0NvdW50Kys7XG5cbiAgICAgICAgcmV0dXJuIHBhc3M7XG4gICAgfTtcbn1cbiJdfQ==
