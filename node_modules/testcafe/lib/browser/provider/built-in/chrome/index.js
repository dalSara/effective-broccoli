'use strict';

exports.__esModule = true;

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _osFamily = require('os-family');

var _osFamily2 = _interopRequireDefault(_osFamily);

var _url = require('url');

var _runtimeInfo = require('./runtime-info');

var _runtimeInfo2 = _interopRequireDefault(_runtimeInfo);

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _localChrome = require('./local-chrome');

var _cdp = require('./cdp');

var cdp = _interopRequireWildcard(_cdp);

var _getMaximizedHeadlessWindowSize = require('../../utils/get-maximized-headless-window-size');

var _getMaximizedHeadlessWindowSize2 = _interopRequireDefault(_getMaximizedHeadlessWindowSize);

var _clientFunctions = require('../../utils/client-functions');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = {
    openedBrowsers: {},

    isMultiBrowser: false,

    openBrowser(browserId, pageUrl, configString) {
        var _this = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var runtimeInfo = yield (0, _runtimeInfo2.default)((0, _url.parse)(pageUrl).hostname, configString);
            var browserName = _this.providerName.replace(':', '');

            runtimeInfo.browserId = browserId;
            runtimeInfo.browserName = browserName;

            runtimeInfo.providerMethods = {
                resizeLocalBrowserWindow: function resizeLocalBrowserWindow(...args) {
                    return _this.resizeLocalBrowserWindow(...args);
                }
            };

            yield (0, _localChrome.start)(pageUrl, runtimeInfo);

            yield _this.waitForConnectionReady(browserId);

            runtimeInfo.viewportSize = yield _this.runInitScript(browserId, _clientFunctions.GET_WINDOW_DIMENSIONS_INFO_SCRIPT);

            yield cdp.createClient(runtimeInfo);

            _this.openedBrowsers[browserId] = runtimeInfo;
        })();
    },

    closeBrowser(browserId) {
        var _this2 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var runtimeInfo = _this2.openedBrowsers[browserId];

            if (cdp.isHeadlessTab(runtimeInfo)) yield cdp.closeTab(runtimeInfo);else yield _this2.closeLocalBrowser(browserId);

            if (_osFamily2.default.mac || runtimeInfo.config.headless) yield (0, _localChrome.stop)(runtimeInfo);

            if (runtimeInfo.tempProfileDir) yield runtimeInfo.tempProfileDir.dispose();

            delete _this2.openedBrowsers[browserId];
        })();
    },

    isLocalBrowser(browserId, configString) {
        var _this3 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var config = _this3.openedBrowsers[browserId] ? _this3.openedBrowsers[browserId].config : (0, _config2.default)(configString);

            return !config.headless;
        })();
    },

    takeScreenshot(browserId, path) {
        var _this4 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var runtimeInfo = _this4.openedBrowsers[browserId];

            yield cdp.takeScreenshot(path, runtimeInfo);
        })();
    },

    resizeWindow(browserId, width, height, currentWidth, currentHeight) {
        var _this5 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var runtimeInfo = _this5.openedBrowsers[browserId];

            if (runtimeInfo.config.mobile) yield cdp.updateMobileViewportSize(runtimeInfo);else {
                runtimeInfo.viewportSize.width = currentWidth;
                runtimeInfo.viewportSize.height = currentHeight;
            }

            yield cdp.resizeWindow({ width, height }, runtimeInfo);
        })();
    },

    maximizeWindow(browserId) {
        var _this6 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const maximumSize = (0, _getMaximizedHeadlessWindowSize2.default)();

            yield _this6.resizeWindow(browserId, maximumSize.width, maximumSize.height, maximumSize.width, maximumSize.height);
        })();
    },

    hasCustomActionForBrowser(browserId) {
        var _this7 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            var _openedBrowsers$brows = _this7.openedBrowsers[browserId],
                config = _openedBrowsers$brows.config,
                client = _openedBrowsers$brows.client;


            return {
                hasCloseBrowser: true,
                hasResizeWindow: !!client && (config.emulation || config.headless),
                hasMaximizeWindow: !!client && config.headless,
                hasTakeScreenshot: !!client,
                hasChromelessScreenshots: !!client,
                hasCanResizeWindowToDimensions: false
            };
        })();
    }
};
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9icm93c2VyL3Byb3ZpZGVyL2J1aWx0LWluL2Nocm9tZS9pbmRleC5qcyJdLCJuYW1lcyI6WyJjZHAiLCJvcGVuZWRCcm93c2VycyIsImlzTXVsdGlCcm93c2VyIiwib3BlbkJyb3dzZXIiLCJicm93c2VySWQiLCJwYWdlVXJsIiwiY29uZmlnU3RyaW5nIiwicnVudGltZUluZm8iLCJob3N0bmFtZSIsImJyb3dzZXJOYW1lIiwicHJvdmlkZXJOYW1lIiwicmVwbGFjZSIsInByb3ZpZGVyTWV0aG9kcyIsInJlc2l6ZUxvY2FsQnJvd3NlcldpbmRvdyIsImFyZ3MiLCJ3YWl0Rm9yQ29ubmVjdGlvblJlYWR5Iiwidmlld3BvcnRTaXplIiwicnVuSW5pdFNjcmlwdCIsIkdFVF9XSU5ET1dfRElNRU5TSU9OU19JTkZPX1NDUklQVCIsImNyZWF0ZUNsaWVudCIsImNsb3NlQnJvd3NlciIsImlzSGVhZGxlc3NUYWIiLCJjbG9zZVRhYiIsImNsb3NlTG9jYWxCcm93c2VyIiwiT1MiLCJtYWMiLCJjb25maWciLCJoZWFkbGVzcyIsInRlbXBQcm9maWxlRGlyIiwiZGlzcG9zZSIsImlzTG9jYWxCcm93c2VyIiwidGFrZVNjcmVlbnNob3QiLCJwYXRoIiwicmVzaXplV2luZG93Iiwid2lkdGgiLCJoZWlnaHQiLCJjdXJyZW50V2lkdGgiLCJjdXJyZW50SGVpZ2h0IiwibW9iaWxlIiwidXBkYXRlTW9iaWxlVmlld3BvcnRTaXplIiwibWF4aW1pemVXaW5kb3ciLCJtYXhpbXVtU2l6ZSIsImhhc0N1c3RvbUFjdGlvbkZvckJyb3dzZXIiLCJjbGllbnQiLCJoYXNDbG9zZUJyb3dzZXIiLCJoYXNSZXNpemVXaW5kb3ciLCJlbXVsYXRpb24iLCJoYXNNYXhpbWl6ZVdpbmRvdyIsImhhc1Rha2VTY3JlZW5zaG90IiwiaGFzQ2hyb21lbGVzc1NjcmVlbnNob3RzIiwiaGFzQ2FuUmVzaXplV2luZG93VG9EaW1lbnNpb25zIl0sIm1hcHBpbmdzIjoi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ZGVyL2J1aWx0LWluL2Nocm9tZS9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBPUyBmcm9tICdvcy1mYW1pbHknO1xuaW1wb3J0IHsgcGFyc2UgYXMgcGFyc2VVcmwgfSBmcm9tICd1cmwnO1xuaW1wb3J0IGdldFJ1bnRpbWVJbmZvIGZyb20gJy4vcnVudGltZS1pbmZvJztcbmltcG9ydCBnZXRDb25maWcgZnJvbSAnLi9jb25maWcnO1xuaW1wb3J0IHsgc3RhcnQgYXMgc3RhcnRMb2NhbENocm9tZSwgc3RvcCBhcyBzdG9wTG9jYWxDaHJvbWUgfSBmcm9tICcuL2xvY2FsLWNocm9tZSc7XG5pbXBvcnQgKiBhcyBjZHAgZnJvbSAnLi9jZHAnO1xuaW1wb3J0IGdldE1heGltaXplZEhlYWRsZXNzV2luZG93U2l6ZSBmcm9tICcuLi8uLi91dGlscy9nZXQtbWF4aW1pemVkLWhlYWRsZXNzLXdpbmRvdy1zaXplJztcbmltcG9ydCB7IEdFVF9XSU5ET1dfRElNRU5TSU9OU19JTkZPX1NDUklQVCB9IGZyb20gJy4uLy4uL3V0aWxzL2NsaWVudC1mdW5jdGlvbnMnO1xuXG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgICBvcGVuZWRCcm93c2Vyczoge30sXG5cbiAgICBpc011bHRpQnJvd3NlcjogZmFsc2UsXG5cbiAgICBhc3luYyBvcGVuQnJvd3NlciAoYnJvd3NlcklkLCBwYWdlVXJsLCBjb25maWdTdHJpbmcpIHtcbiAgICAgICAgdmFyIHJ1bnRpbWVJbmZvID0gYXdhaXQgZ2V0UnVudGltZUluZm8ocGFyc2VVcmwocGFnZVVybCkuaG9zdG5hbWUsIGNvbmZpZ1N0cmluZyk7XG4gICAgICAgIHZhciBicm93c2VyTmFtZSA9IHRoaXMucHJvdmlkZXJOYW1lLnJlcGxhY2UoJzonLCAnJyk7XG5cbiAgICAgICAgcnVudGltZUluZm8uYnJvd3NlcklkICAgPSBicm93c2VySWQ7XG4gICAgICAgIHJ1bnRpbWVJbmZvLmJyb3dzZXJOYW1lID0gYnJvd3Nlck5hbWU7XG5cbiAgICAgICAgcnVudGltZUluZm8ucHJvdmlkZXJNZXRob2RzID0ge1xuICAgICAgICAgICAgcmVzaXplTG9jYWxCcm93c2VyV2luZG93OiAoLi4uYXJncykgPT4gdGhpcy5yZXNpemVMb2NhbEJyb3dzZXJXaW5kb3coLi4uYXJncylcbiAgICAgICAgfTtcblxuICAgICAgICBhd2FpdCBzdGFydExvY2FsQ2hyb21lKHBhZ2VVcmwsIHJ1bnRpbWVJbmZvKTtcblxuICAgICAgICBhd2FpdCB0aGlzLndhaXRGb3JDb25uZWN0aW9uUmVhZHkoYnJvd3NlcklkKTtcblxuICAgICAgICBydW50aW1lSW5mby52aWV3cG9ydFNpemUgPSBhd2FpdCB0aGlzLnJ1bkluaXRTY3JpcHQoYnJvd3NlcklkLCBHRVRfV0lORE9XX0RJTUVOU0lPTlNfSU5GT19TQ1JJUFQpO1xuXG4gICAgICAgIGF3YWl0IGNkcC5jcmVhdGVDbGllbnQocnVudGltZUluZm8pO1xuXG4gICAgICAgIHRoaXMub3BlbmVkQnJvd3NlcnNbYnJvd3NlcklkXSA9IHJ1bnRpbWVJbmZvO1xuICAgIH0sXG5cbiAgICBhc3luYyBjbG9zZUJyb3dzZXIgKGJyb3dzZXJJZCkge1xuICAgICAgICB2YXIgcnVudGltZUluZm8gPSB0aGlzLm9wZW5lZEJyb3dzZXJzW2Jyb3dzZXJJZF07XG5cbiAgICAgICAgaWYgKGNkcC5pc0hlYWRsZXNzVGFiKHJ1bnRpbWVJbmZvKSlcbiAgICAgICAgICAgIGF3YWl0IGNkcC5jbG9zZVRhYihydW50aW1lSW5mbyk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xvc2VMb2NhbEJyb3dzZXIoYnJvd3NlcklkKTtcblxuICAgICAgICBpZiAoT1MubWFjIHx8IHJ1bnRpbWVJbmZvLmNvbmZpZy5oZWFkbGVzcylcbiAgICAgICAgICAgIGF3YWl0IHN0b3BMb2NhbENocm9tZShydW50aW1lSW5mbyk7XG5cbiAgICAgICAgaWYgKHJ1bnRpbWVJbmZvLnRlbXBQcm9maWxlRGlyKVxuICAgICAgICAgICAgYXdhaXQgcnVudGltZUluZm8udGVtcFByb2ZpbGVEaXIuZGlzcG9zZSgpO1xuXG4gICAgICAgIGRlbGV0ZSB0aGlzLm9wZW5lZEJyb3dzZXJzW2Jyb3dzZXJJZF07XG4gICAgfSxcblxuICAgIGFzeW5jIGlzTG9jYWxCcm93c2VyIChicm93c2VySWQsIGNvbmZpZ1N0cmluZykge1xuICAgICAgICB2YXIgY29uZmlnID0gdGhpcy5vcGVuZWRCcm93c2Vyc1ticm93c2VySWRdID8gdGhpcy5vcGVuZWRCcm93c2Vyc1ticm93c2VySWRdLmNvbmZpZyA6IGdldENvbmZpZyhjb25maWdTdHJpbmcpO1xuXG4gICAgICAgIHJldHVybiAhY29uZmlnLmhlYWRsZXNzO1xuICAgIH0sXG5cbiAgICBhc3luYyB0YWtlU2NyZWVuc2hvdCAoYnJvd3NlcklkLCBwYXRoKSB7XG4gICAgICAgIHZhciBydW50aW1lSW5mbyA9IHRoaXMub3BlbmVkQnJvd3NlcnNbYnJvd3NlcklkXTtcblxuICAgICAgICBhd2FpdCBjZHAudGFrZVNjcmVlbnNob3QocGF0aCwgcnVudGltZUluZm8pO1xuICAgIH0sXG5cbiAgICBhc3luYyByZXNpemVXaW5kb3cgKGJyb3dzZXJJZCwgd2lkdGgsIGhlaWdodCwgY3VycmVudFdpZHRoLCBjdXJyZW50SGVpZ2h0KSB7XG4gICAgICAgIHZhciBydW50aW1lSW5mbyA9IHRoaXMub3BlbmVkQnJvd3NlcnNbYnJvd3NlcklkXTtcblxuICAgICAgICBpZiAocnVudGltZUluZm8uY29uZmlnLm1vYmlsZSlcbiAgICAgICAgICAgIGF3YWl0IGNkcC51cGRhdGVNb2JpbGVWaWV3cG9ydFNpemUocnVudGltZUluZm8pO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJ1bnRpbWVJbmZvLnZpZXdwb3J0U2l6ZS53aWR0aCAgPSBjdXJyZW50V2lkdGg7XG4gICAgICAgICAgICBydW50aW1lSW5mby52aWV3cG9ydFNpemUuaGVpZ2h0ID0gY3VycmVudEhlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IGNkcC5yZXNpemVXaW5kb3coeyB3aWR0aCwgaGVpZ2h0IH0sIHJ1bnRpbWVJbmZvKTtcbiAgICB9LFxuXG4gICAgYXN5bmMgbWF4aW1pemVXaW5kb3cgKGJyb3dzZXJJZCkge1xuICAgICAgICBjb25zdCBtYXhpbXVtU2l6ZSA9IGdldE1heGltaXplZEhlYWRsZXNzV2luZG93U2l6ZSgpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMucmVzaXplV2luZG93KGJyb3dzZXJJZCwgbWF4aW11bVNpemUud2lkdGgsIG1heGltdW1TaXplLmhlaWdodCwgbWF4aW11bVNpemUud2lkdGgsIG1heGltdW1TaXplLmhlaWdodCk7XG4gICAgfSxcblxuICAgIGFzeW5jIGhhc0N1c3RvbUFjdGlvbkZvckJyb3dzZXIgKGJyb3dzZXJJZCkge1xuICAgICAgICB2YXIgeyBjb25maWcsIGNsaWVudCB9ID0gdGhpcy5vcGVuZWRCcm93c2Vyc1ticm93c2VySWRdO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoYXNDbG9zZUJyb3dzZXI6ICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICBoYXNSZXNpemVXaW5kb3c6ICAgICAgICAgICAgICAgICEhY2xpZW50ICYmIChjb25maWcuZW11bGF0aW9uIHx8IGNvbmZpZy5oZWFkbGVzcyksXG4gICAgICAgICAgICBoYXNNYXhpbWl6ZVdpbmRvdzogICAgICAgICAgICAgICEhY2xpZW50ICYmIGNvbmZpZy5oZWFkbGVzcyxcbiAgICAgICAgICAgIGhhc1Rha2VTY3JlZW5zaG90OiAgICAgICAgICAgICAgISFjbGllbnQsXG4gICAgICAgICAgICBoYXNDaHJvbWVsZXNzU2NyZWVuc2hvdHM6ICAgICAgICEhY2xpZW50LFxuICAgICAgICAgICAgaGFzQ2FuUmVzaXplV2luZG93VG9EaW1lbnNpb25zOiBmYWxzZVxuICAgICAgICB9O1xuICAgIH1cbn07XG4iXX0=
